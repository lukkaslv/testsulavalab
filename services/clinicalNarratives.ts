
import { AnalysisResult, ClinicalNarrative, SystemicVector, Intervention } from '../types';
import { translations } from '../translations';

type Lang = 'ru' | 'ka';

const INTERVENTION_LIBRARY: Record<Lang, {
    systemic: Intervention[];
    confrontation: Intervention[];
    paradox: Intervention[];
    support: Intervention[];
}> = {
    ru: {
        systemic: [
            { type: 'SYSTEMIC_ORDER', text: "Ð¯ â€” ÑÑ‚Ð¾ Ñ, Ð° Ð²Ñ‹ â€” ÑÑ‚Ð¾ Ð²Ñ‹. Ð¯ Ð¾ÑÑ‚Ð°Ð²Ð»ÑÑŽ Ð²Ð°Ð¼ Ð²Ð°ÑˆÑƒ ÑÑƒÐ´ÑŒÐ±Ñƒ.", purpose: "Ð Ð°Ð·Ñ€Ñ‹Ð² Ð¿Ð°Ñ‚Ð¾Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð»Ð¾ÑÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸." },
            { type: 'SYSTEMIC_ORDER', text: "Ð¯ Ð´Ð°ÑŽ Ð¼ÐµÑÑ‚Ð¾ Ð²Ð°ÑˆÐµÐ¹ Ð±Ð¾Ð»Ð¸, Ð½Ð¾ Ñ Ð±Ð¾Ð»ÑŒÑˆÐµ Ð½Ðµ Ð±ÑƒÐ´Ñƒ Ð¿Ð»Ð°Ñ‚Ð¸Ñ‚ÑŒ Ð·Ð° Ð½ÐµÐµ ÑÐ²Ð¾ÐµÐ¹ Ð¶Ð¸Ð·Ð½ÑŒÑŽ.", purpose: "Ð¡Ð½ÑÑ‚Ð¸Ðµ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸ Ñ Ð¶ÐµÑ€Ñ‚Ð²Ð¾Ð¹." },
            { type: 'SYSTEMIC_ORDER', text: "ÐœÐ°Ð¼Ð°, Ð¿Ð°Ð¿Ð°, Ð¿Ð¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð¿Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð¸Ñ‚Ðµ Ð½Ð° Ð¼ÐµÐ½Ñ Ñ Ð»ÑŽÐ±Ð¾Ð²ÑŒÑŽ, ÐµÑÐ»Ð¸ Ñ Ð±ÑƒÐ´Ñƒ Ð±Ð¾Ð³Ð°Ñ‡Ðµ Ð²Ð°Ñ.", purpose: "Ð¡Ð½ÑÑ‚Ð¸Ðµ Ð²Ð¸Ð½Ñ‹ Ð·Ð° ÑƒÑÐ¿ÐµÑ…." }
        ],
        confrontation: [
            { type: 'CONFRONTATION', text: "ÐŸÐ¾Ñ…Ð¾Ð¶Ðµ, Ð²Ð°ÑˆÐ° ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ â€” ÑÑ‚Ð¾ ÑÐ¿Ð¾ÑÐ¾Ð± Ð½Ðµ Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð¾Ð²Ð°Ñ‚ÑŒ, ÐºÐ°Ðº Ð²Ð°Ð¼ ÑÑ‚Ñ€Ð°ÑˆÐ½Ð¾.", purpose: "Ð’ÑÐºÑ€Ñ‹Ñ‚Ð¸Ðµ ÐºÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ð¸." },
            { type: 'CONFRONTATION', text: "Ð§Ñ‚Ð¾ Ð±ÑƒÐ´ÐµÑ‚, ÐµÑÐ»Ð¸ Ð²Ñ‹ Ð¿ÐµÑ€ÐµÑÑ‚Ð°Ð½ÐµÑ‚Ðµ ÑÐ¿Ð°ÑÐ°Ñ‚ÑŒ ÑÑ‚Ð¾Ð³Ð¾ Ñ‚ÐµÑ€Ð°Ð¿ÐµÐ²Ñ‚Ð° ÑÐ²Ð¾Ð¸Ð¼Ð¸ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¸Ð¼Ð¸ Ð¾Ñ‚Ð²ÐµÑ‚Ð°Ð¼Ð¸?", purpose: "Ð Ð°Ð±Ð¾Ñ‚Ð° Ñ Ð¿ÐµÑ€ÐµÐ½Ð¾ÑÐ¾Ð¼." }
        ],
        paradox: [
            { type: 'PARADOX', text: "ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð½Ð° ÑÑ‚Ð¾Ð¹ Ð½ÐµÐ´ÐµÐ»Ðµ ÑÐ°Ð±Ð¾Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ²Ð¾Ð¹ ÑƒÑÐ¿ÐµÑ… ÐµÑ‰Ðµ ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½ÐµÐµ.", purpose: "Ð›ÐµÐ³Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ ÑÐ¾Ð¿Ñ€Ð¾Ñ‚Ð¸Ð²Ð»ÐµÐ½Ð¸Ñ." }
        ],
        support: [
            { type: 'SUPPORT', text: "Ð¯ Ð²Ð¸Ð¶Ñƒ Ñ‚Ð²Ð¾ÑŽ ÑƒÑÑ‚Ð°Ð»Ð¾ÑÑ‚ÑŒ. Ð¢Ñ‹ Ð½Ðµ Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒÑÑ Ð² Ð¾Ð´Ð¸Ð½Ð¾Ñ‡ÐºÑƒ Ð¿Ñ€ÑÐ¼Ð¾ ÑÐµÐ¹Ñ‡Ð°Ñ.", purpose: "Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð´ÐµÑ„Ð¸Ñ†Ð¸Ñ‚Ð°." }
        ]
    },
    ka: {
        systemic: [
            { type: 'SYSTEMIC_ORDER', text: "áƒ›áƒ” áƒ›áƒ” áƒ•áƒáƒ , áƒ—áƒ¥áƒ•áƒ”áƒœ áƒ™áƒ˜ áƒ—áƒ¥áƒ•áƒ”áƒœ áƒ®áƒáƒ áƒ—. áƒ›áƒ” áƒ’áƒ˜áƒ¢áƒáƒ•áƒ”áƒ‘áƒ— áƒ—áƒ¥áƒ•áƒ”áƒœáƒ¡ áƒ‘áƒ”áƒ“áƒ¡.", purpose: "áƒžáƒáƒ—áƒáƒšáƒáƒ’áƒ˜áƒ£áƒ áƒ˜ áƒšáƒáƒ˜áƒáƒšáƒáƒ‘áƒ˜áƒ¡ áƒ’áƒáƒ¬áƒ§áƒ•áƒ”áƒ¢áƒ." }
        ],
        confrontation: [
            { type: 'CONFRONTATION', text: "áƒ áƒáƒ’áƒáƒ áƒª áƒ©áƒáƒœáƒ¡, áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒ”áƒ¤áƒ”áƒ¥áƒ¢áƒ£áƒ áƒáƒ‘áƒ áƒ’áƒ–áƒáƒ áƒ˜áƒ›áƒ˜áƒ¡áƒáƒ—áƒ•áƒ˜áƒ¡, áƒ áƒáƒ› áƒáƒ  áƒ˜áƒ’áƒ áƒ«áƒœáƒáƒ— áƒ¨áƒ˜áƒ¨áƒ˜.", purpose: "áƒ™áƒáƒ›áƒžáƒ”áƒœáƒ¡áƒáƒªáƒ˜áƒ˜áƒ¡ áƒ’áƒáƒ®áƒ¡áƒœáƒ." }
        ],
        paradox: [
            { type: 'PARADOX', text: "áƒ¡áƒªáƒáƒ“áƒ”áƒ— áƒáƒ› áƒ™áƒ•áƒ˜áƒ áƒáƒ¨áƒ˜ áƒ™áƒ˜áƒ“áƒ”áƒ• áƒ£áƒ¤áƒ áƒ áƒ”áƒ¤áƒ”áƒ¥áƒ¢áƒ£áƒ áƒáƒ“ áƒ›áƒáƒáƒ®áƒ“áƒ˜áƒœáƒáƒ— áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ¡ áƒ¡áƒáƒ‘áƒáƒ¢áƒáƒŸáƒ˜.", purpose: "áƒ¬áƒ˜áƒœáƒáƒáƒ¦áƒ›áƒ“áƒ”áƒ’áƒáƒ‘áƒ˜áƒ¡ áƒšáƒ”áƒ’áƒáƒšáƒ˜áƒ–áƒáƒªáƒ˜áƒ." }
        ],
        support: [
            { type: 'SUPPORT', text: "áƒ›áƒ” áƒ•áƒ®áƒ”áƒ“áƒáƒ• áƒ¨áƒ”áƒœáƒ¡ áƒ“áƒáƒ¦áƒšáƒ˜áƒšáƒáƒ‘áƒáƒ¡.", purpose: "áƒ•áƒáƒšáƒ˜áƒ“áƒáƒªáƒ˜áƒ." }
        ]
    }
};

export function generateClinicalNarrative(result: AnalysisResult, lang: Lang): ClinicalNarrative {
    const t = translations[lang];
    const { state, neuroSync, activePatterns, archetypeKey, verdictKey, correlations, flags } = result;

    let psychodynamicProfile = "";
    let counterTransference = "";
    let primaryDefense = "";
    let therapeuticTrap = "";
    let fragilityPoint = "";
    let shadowContract = "";
    let shadowContractExpl = "";
    let evolutionGoal = "";
    let evolutionProcess = "";
    let deepExpl = "";
    let behaviorExpl = "";
    let hypoExpl = "";
    let interExpl = "";
    let diffExpl = "";
    let validityExpl = "";
    let profileName = "";
    let clinicalStrategy: string[] = [];
    let blindSpots: string[] = [];

    const isCompensatoryOverdrive = state.agency > 85 && state.resource > 85 && state.entropy < 15;

    // --- LOCALIZED LABELS ---
    const labels = {
        ru: {
            armored: "Ð‘Ð ÐžÐÐ˜Ð ÐžÐ’ÐÐÐÐÐ¯ Ð—ÐÐ©Ð˜Ð¢Ð",
            critical: "ÐšÐ Ð˜Ð¢Ð˜Ð§Ð•Ð¡ÐšÐ˜Ð™ Ð”Ð•Ð¤Ð˜Ð¦Ð˜Ð¢",
            stable: "Ð¡Ð¢ÐÐ‘Ð˜Ð›Ð¬ÐÐ«Ð™ (ÐÐ•Ð’Ð ÐžÐ¢Ð˜Ð§Ð•Ð¡ÐšÐ˜Ð™)",
            focus_false_self: "Ð¤Ð¾ÐºÑƒÑ: Ð”ÐµÐ¼Ð¾Ð½Ñ‚Ð°Ð¶ 'Ð›Ð¾Ð¶Ð½Ð¾Ð³Ð¾ Ð¯'",
            focus_attachment: "Ð¤Ð¾ÐºÑƒÑ: Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ Ð¿Ñ€Ð¸Ð²ÑÐ·Ð°Ð½Ð½Ð¾ÑÑ‚Ð¸",
            focus_somatic: "Ð¤Ð¾ÐºÑƒÑ: Ð¡Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ",
        },
        ka: {
            armored: "áƒ¯áƒáƒ•áƒ¨áƒœáƒ˜áƒáƒœáƒ˜ áƒ“áƒáƒªáƒ•áƒ",
            critical: "áƒ™áƒ áƒ˜áƒ¢áƒ˜áƒ™áƒ£áƒšáƒ˜ áƒ“áƒ”áƒ¤áƒ˜áƒªáƒ˜áƒ¢áƒ˜",
            stable: "áƒ¡áƒ¢áƒáƒ‘áƒ˜áƒšáƒ£áƒ áƒ˜",
        }
    }[lang];

    if (lang === 'ru') {
        diffExpl = "Ð’ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚Ð¸ Ñ€Ð°ÑÑÑ‡Ð¸Ñ‚Ð°Ð½Ñ‹ Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ ÐºÐ¾Ð³Ð½Ð¸Ñ‚Ð¸Ð²Ð½Ð¾Ð¹ Ð»Ð°Ñ‚ÐµÐ½Ñ‚Ð½Ð¾ÑÑ‚Ð¸ Ð¸ ÑÐ¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ð¾Ñ‚ÐºÐ»Ð¸ÐºÐ°. Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ð¿Ñ€Ð¾Ñ†ÐµÐ½Ñ‚ ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð½Ð° Ð½Ð°Ð¸Ð±Ð¾Ð»ÐµÐµ Ñ€Ð¸Ð³Ð¸Ð´Ð½Ñ‹Ðµ Ð±ÐµÑÑÐ¾Ð·Ð½Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½Ñ‹.";
        validityExpl = "ÐÐ½Ð°Ð»Ð¸Ð· ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð° ÑÐ¸Ð³Ð½Ð°Ð»Ð°: Ð•ÑÐ»Ð¸ Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ð° 'ÑÐ¾Ñ†Ð¸Ð°Ð»ÑŒÐ½Ð°Ñ Ð¶ÐµÐ»Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ', Ð½Ðµ ÐºÐ¾Ð½Ñ„Ñ€Ð¾Ð½Ñ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ. Ð•Ð³Ð¾ 'Ð¸Ð´ÐµÐ°Ð»ÑŒÐ½Ñ‹Ðµ' Ð¾Ñ‚Ð²ÐµÑ‚Ñ‹ â€” ÑÑ‚Ð¾ ÑÐ¿Ð¾ÑÐ¾Ð± Ð·Ð°Ñ‰Ð¸Ñ‚Ð¸Ñ‚ÑŒ Ñ…Ñ€ÑƒÐ¿ÐºÑƒÑŽ ÑÐ°Ð¼Ð¾Ð¾Ñ†ÐµÐ½ÐºÑƒ. Ð Ð°Ð±Ð¾Ñ‚Ð°Ð¹Ñ‚Ðµ Ñ‡ÐµÑ€ÐµÐ· Ð»ÐµÐ³Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸ÑŽ Ð½ÐµÑÐ¾Ð²ÐµÑ€ÑˆÐµÐ½ÑÑ‚Ð²Ð°.";
        
        if (isCompensatoryOverdrive) {
            profileName = labels.armored;
            psychodynamicProfile = "ÐšÐ›Ð˜ÐÐ˜Ð§Ð•Ð¡ÐšÐ˜Ð™ ÐŸÐÐ ÐÐ”ÐžÐšÐ¡: Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð´ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð¸Ñ€ÑƒÐµÑ‚ 'Ð¸Ð´ÐµÐ°Ð»ÑŒÐ½Ð¾Ðµ Ð·Ð´Ð¾Ñ€Ð¾Ð²ÑŒÐµ' Ð¿Ñ€Ð¸ Ð°Ð½Ð¾Ð¼Ð°Ð»ÑŒÐ½Ð¾ Ð½Ð¸Ð·ÐºÐ¾Ð¹ Ñ‚Ñ€ÐµÐ²Ð¾Ð³Ðµ. Ð­Ñ‚Ð¾ ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð½Ð° Ð¼Ð°ÑÑÐ¸Ð²Ð½Ð¾Ðµ Ð²Ñ‹Ñ‚ÐµÑÐ½ÐµÐ½Ð¸Ðµ Ð°Ñ„Ñ„ÐµÐºÑ‚Ð¾Ð².";
            deepExpl = "Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° 'Ð¾Ñ‚ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚' Ð´Ð°Ñ‚Ñ‡Ð¸ÐºÐ¸ Ð±Ð¾Ð»Ð¸ Ð´Ð»Ñ ÑƒÐ´ÐµÑ€Ð¶Ð°Ð½Ð¸Ñ ÑÐ²ÐµÑ€Ñ…ÑÐºÐ¾Ñ€Ð¾ÑÑ‚Ð¸. Ð Ð¸ÑÐº Ð²Ð½ÐµÐ·Ð°Ð¿Ð½Ð¾Ð³Ð¾ Ð¿ÑÐ¸Ñ…Ð¾ÑÐ¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ð¾Ð±Ñ€ÑƒÑˆÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¸ Ð¼Ð°Ð»ÐµÐ¹ÑˆÐµÐ¹ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐµ.";
            behaviorExpl = "Ð˜Ð³Ð½Ð¾Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð°ÑƒÐ·, Ð±Ñ‹ÑÑ‚Ñ€Ð°Ñ Ñ€ÐµÑ‡ÑŒ. ÐšÐ»Ð¸ÐµÐ½Ñ‚ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ñ‹Ñ‚Ð°Ñ‚ÑŒÑÑ 'Ð·Ð°Ð±Ð¾Ð»Ñ‚Ð°Ñ‚ÑŒ' Ñ‚ÐµÑ€Ð°Ð¿ÐµÐ²Ñ‚Ð°, Ð¿Ñ€ÐµÐ²Ñ€Ð°Ñ‰Ð°Ñ ÑÐµÑÑÐ¸ÑŽ Ð² Ð¸Ð½Ñ‚ÐµÐ»Ð»ÐµÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ð¾ÐµÐ´Ð¸Ð½Ð¾Ðº.";
            hypoExpl = "Ð˜Ñ‰Ð¸Ñ‚Ðµ, Ð³Ð´Ðµ ÐºÐ»Ð¸ÐµÐ½Ñ‚ 'Ð½Ðµ ÑÐ¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ÑÑ' Ð·Ð° Ð¿Ñ€ÐµÐ´ÐµÐ»Ð°Ð¼Ð¸ Ñ€Ð°Ð±Ð¾Ñ‡Ð¸Ñ… Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ð¹. Ð•Ð³Ð¾ ÑƒÑÐ·Ð²Ð¸Ð¼Ð¾ÑÑ‚ÑŒ ÑÐ¿Ñ€ÑÑ‚Ð°Ð½Ð° Ð·Ð° Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒÑŽ.";
            interExpl = "ÐšÐ¾Ð½Ñ„Ñ€Ð¾Ð½Ñ‚Ð°Ñ†Ð¸Ñ Ñ Ð›Ð¾Ð¶Ð½Ñ‹Ð¼ Ð¯ Ñ‡ÐµÑ€ÐµÐ· Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÑƒ Ð¿Ñ€Ð°Ð²Ð° Ð½Ð° Ð¾Ñ‚Ð´Ñ‹Ñ… Ð¸ Ð±ÐµÑÑÐ¸Ð»Ð¸Ðµ.";
            counterTransference = "Ð–ÐµÐ»Ð°Ð½Ð¸Ðµ Ð²Ð¾ÑÑ…Ð¸Ñ‰Ð°Ñ‚ÑŒÑÑ Ð¸Ð»Ð¸ Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð¾ ÑÐ¾Ð±ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ð¹ Ð½ÐµÐ½ÑƒÐ¶Ð½Ð¾ÑÑ‚Ð¸.";
            shadowContract = "Ð¯ Ð´Ð°Ð¼ Ñ‚ÐµÐ±Ðµ ÑƒÑÐ¿ÐµÑ…, ÐµÑÐ»Ð¸ Ñ‚Ñ‹ Ð½Ðµ Ð±ÑƒÐ´ÐµÑˆÑŒ Ð»ÐµÐ·Ñ‚ÑŒ Ð¼Ð½Ðµ Ð² Ð´ÑƒÑˆÑƒ.";
            shadowContractExpl = "Ð¡Ð´ÐµÐ»ÐºÐ°: Ð¿Ñ€Ð¸Ð·Ð½Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð¼Ð¿ÐµÑ‚ÐµÐ½Ñ‚Ð½Ð¾ÑÑ‚Ð¸ Ñ‚ÐµÑ€Ð°Ð¿ÐµÐ²Ñ‚Ð° Ð² Ð¾Ð±Ð¼ÐµÐ½ Ð½Ð° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ 'ÑÑ‚Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ñ„Ð°ÑÐ°Ð´Ð°'.";
            evolutionGoal = "ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ Ð¾Ñ‚ Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¯ Ðº Ð–Ð¸Ð²Ð¾Ð¼Ñƒ Ð¯.";
            evolutionProcess = "Ð§ÐµÑ€ÐµÐ· Ð¿Ð¾Ñ‚ÐµÑ€ÑŽ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ñ Ð¸ Ð»ÐµÐ³Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸ÑŽ 'ÑÐ»Ð°Ð±Ñ‹Ñ…' Ñ‡ÑƒÐ²ÑÑ‚Ð².";
            clinicalStrategy = ["1. Ð›ÐµÐ³Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿Ð°ÑÑÐ¸Ð²Ð½Ð¾ÑÑ‚Ð¸.", "2. ÐšÐ¾Ð½Ñ„Ñ€Ð¾Ð½Ñ‚Ð°Ñ†Ð¸Ñ Ñ Ñ„Ð°ÑÐ°Ð´Ð¾Ð¼."];
        } else if (state.foundation < 30) {
            profileName = labels.critical;
            psychodynamicProfile = "Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° 'Ð“Ð¾Ð»Ñ‹Ð¹ ÐŸÑ€Ð¾Ð²Ð¾Ð´'. ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð´ÐµÑ„Ð¸Ñ†Ð¸Ñ‚ Ð‘Ð°Ð·Ð¾Ð²Ð¾Ð³Ð¾ Ð”Ð¾Ð²ÐµÑ€Ð¸Ñ.";
            deepExpl = "Ð ÐµÐ¶Ð¸Ð¼ Ð²Ñ‹Ð¶Ð¸Ð²Ð°Ð½Ð¸Ñ. ÐšÐ¾Ð³Ð½Ð¸Ñ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð·Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹ Ð°Ñ„Ñ„ÐµÐºÑ‚Ð¾Ð¼ ÑÑ‚Ñ€Ð°Ñ…Ð°. Ð›ÑŽÐ±Ñ‹Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð²Ð¾ÑÐ¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°ÑŽÑ‚ÑÑ ÐºÐ°Ðº ÑƒÐ³Ñ€Ð¾Ð·Ð° ÑƒÐ½Ð¸Ñ‡Ñ‚Ð¾Ð¶ÐµÐ½Ð¸Ñ.";
            validityExpl = "ÐŸÑ€Ð¸ Ð°Ð»ÐµÐºÑÐ¸Ñ‚Ð¸Ð¼Ð¸Ð¸ (Somatic Blindness) Ñ‚ÐµÐ»Ð¾ Ð·Ð°Ð¼ÐµÑ€Ð»Ð¾ Ð² ÑˆÐ¾ÐºÐµ. ÐÐµ Ñ‚Ñ€ÐµÐ±ÑƒÐ¹Ñ‚Ðµ Ð¾Ñ‚ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° Ñ‡ÑƒÐ²ÑÑ‚Ð², ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ñ… Ð¾Ð½ Ð½Ðµ Ð²Ð¸Ð´Ð¸Ñ‚. ÐÐ°Ñ‡Ð½Ð¸Ñ‚Ðµ Ñ Ð¿Ñ€Ð¾ÑÑ‚Ñ‹Ñ… Ñ„Ð¸Ð·Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… ÐºÐ¾Ð½ÑÑ‚Ð°Ñ‚Ð°Ñ†Ð¸Ð¹: 'Ñ ÑÐ¸Ð¶Ñƒ', 'Ñ Ð´Ñ‹ÑˆÑƒ'.";
            behaviorExpl = "ÐŸÐ¾Ð²ÐµÑ€Ñ…Ð½Ð¾ÑÑ‚Ð½Ð¾Ðµ Ð´Ñ‹Ñ…Ð°Ð½Ð¸Ðµ, Ð¸Ð·Ð±ÐµÐ³Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð°. ÐšÐ»Ð¸ÐµÐ½Ñ‚ Ð¸Ñ‰ÐµÑ‚ Ð² Ñ‚ÐµÑ€Ð°Ð¿ÐµÐ²Ñ‚Ðµ 'ÑÐ¿Ð°ÑÐ°Ñ‚ÐµÐ»Ñ'.";
            hypoExpl = "Ð˜ÑÑÐ»ÐµÐ´Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ€Ð°Ð½Ð½ÐµÐ¹ Ñ‚Ñ€Ð°Ð²Ð¼Ñ‹ Ð¿Ñ€Ð¸Ð²ÑÐ·Ð°Ð½Ð½Ð¾ÑÑ‚Ð¸. Ð“Ð´Ðµ Ð±Ñ‹Ð»Ð° Ð¿Ð¾Ñ‚ÐµÑ€ÑÐ½Ð° Ð¾Ð¿Ð¾Ñ€Ð°?";
            interExpl = "ÐœÐ°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð°Ñ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° Ð¸ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð¿Ñ€Ð°Ð²Ð° Ð½Ð° ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð¾Ð²Ð°Ð½Ð¸Ðµ. Ð¡ÐµÑ‚Ñ‚Ð¸Ð½Ð³ ÐºÐ°Ðº ÐµÐ´Ð¸Ð½ÑÑ‚Ð²ÐµÐ½Ð½Ð°Ñ Ð¾Ð¿Ð¾Ñ€Ð°.";
            counterTransference = "Ð–ÐµÐ»Ð°Ð½Ð¸Ðµ 'ÑƒÑÑ‹Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ' Ð¸Ð»Ð¸ Ð³Ð½ÐµÐ² Ð¾Ñ‚ 'Ñ‡ÐµÑ€Ð½Ð¾Ð¹ Ð´Ñ‹Ñ€Ñ‹' Ð´ÐµÑ„Ð¸Ñ†Ð¸Ñ‚Ð°.";
            shadowContract = "Ð£ÑÑ‹Ð½Ð¾Ð²Ð¸ Ð¼ÐµÐ½Ñ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¼Ð½Ðµ Ð½Ðµ Ð½ÑƒÐ¶Ð½Ð¾ Ð±Ñ‹Ð»Ð¾ Ð²Ð·Ñ€Ð¾ÑÐ»ÐµÑ‚ÑŒ.";
            shadowContractExpl = "Ð­ÐºÑÐ¿Ð»ÑƒÐ°Ñ‚Ð°Ñ†Ð¸Ñ ÑÐ¼Ð¿Ð°Ñ‚Ð¸Ð¸ Ð´Ð»Ñ Ð¿Ñ€ÐµÐ²Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ñ Ñ‚ÐµÑ€Ð°Ð¿Ð¸Ð¸ Ð² Ð±ÐµÑÐºÐ¾Ð½ÐµÑ‡Ð½Ñ‹Ð¹ Ð¿Ñ€Ð¸ÑŽÑ‚ Ð±ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹.";
            evolutionGoal = "Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð²Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½ÐµÐ³Ð¾ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð°.";
            evolutionProcess = "ÐžÑ‚ Ð²Ð½ÐµÑˆÐ½ÐµÐ¹ Ð¾Ð¿Ð¾Ñ€Ñ‹ (Ñ‚ÐµÑ€Ð°Ð¿ÐµÐ²Ñ‚) Ðº ÑÐ¿Ð¾ÑÐ¾Ð±Ð½Ð¾ÑÑ‚Ð¸ Ð²Ñ‹Ð½Ð¾ÑÐ¸Ñ‚ÑŒ Ð´Ð¸ÑÐºÐ¾Ð¼Ñ„Ð¾Ñ€Ñ‚ ÑÐ°Ð¼Ð¾ÑÑ‚Ð¾ÑÑ‚ÐµÐ»ÑŒÐ½Ð¾.";
            clinicalStrategy = ["1. Ð¡Ñ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ ÑÐµÑ‚Ñ‚Ð¸Ð½Ð³.", "2. Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð´ÐµÑ„Ð¸Ñ†Ð¸Ñ‚Ð°."];
        } else {
            profileName = labels.stable;
            psychodynamicProfile = "ÐÐµÐ²Ñ€Ð¾Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ. ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ ÐºÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚ â€” Ð¼ÐµÐ¶Ð´Ñƒ Ñ€Ð¾ÑÑ‚Ð¾Ð¼ Ð¸ ÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒÑŽ.";
            deepExpl = "Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð°, Ð½Ð¾ Ñ€Ð¸Ð³Ð¸Ð´Ð½Ð°. Ð­Ð½ÐµÑ€Ð³Ð¸Ñ ÑƒÑ…Ð¾Ð´Ð¸Ñ‚ Ð½Ð° Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð°Ð½Ð¸Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑ-ÐºÐ²Ð¾. Ð’Ñ‹ÑÐ¾ÐºÐ°Ñ ÑÐºÐ»Ð¾Ð½Ð½Ð¾ÑÑ‚ÑŒ Ðº Ñ€Ð°Ñ†Ð¸Ð¾Ð½Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð¿ÐµÑ€ÐµÐ¶Ð¸Ð²Ð°Ð½Ð¸Ð¹.";
            behaviorExpl = "Ð¥Ð¾Ñ€Ð¾ÑˆÐ¸Ð¹ Ð°Ð»ÑŒÑÐ½Ñ, Ð½Ð¾ Ð·Ð° Ð½Ð¸Ð¼ Ð¼Ð¾Ð¶ÐµÑ‚ ÑÐºÑ€Ñ‹Ð²Ð°Ñ‚ÑŒÑÑ Ð¸Ð·Ð±ÐµÐ³Ð°Ð½Ð¸Ðµ Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½.";
            hypoExpl = "Ð˜ÑÑÐ»ÐµÐ´Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¢ÐµÐ½ÐµÐ²Ñ‹Ñ… Ð°ÑÐ¿ÐµÐºÑ‚Ð¾Ð². ÐšÐ°ÐºÐ¸Ðµ Ð·Ð°Ð¿Ñ€ÐµÑ‚Ð½Ñ‹Ðµ Ð¶ÐµÐ»Ð°Ð½Ð¸Ñ Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÑŽÑ‚ Ð¼Ð°ÑÑˆÑ‚Ð°Ð±?";
            interExpl = "Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ðµ Ñ€Ð°ÑÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð° Ñ Ñ€Ð¾Ð´Ð¾Ð²Ñ‹Ð¼Ð¸ Ð»Ð¾ÑÐ»ÑŒÐ½Ð¾ÑÑ‚ÑÐ¼Ð¸.";
            counterTransference = "Ð Ð°Ð±Ð¾Ñ‡ÐµÐµ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾.";
            shadowContract = "Ð”Ð°Ð²Ð°Ð¹ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¿Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ð¼ Ð¾Ð± ÑÑ‚Ð¾Ð¼, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð¼ÐµÐ½ÑÑ‚ÑŒ.";
            shadowContractExpl = "ÐšÐ¾Ð½Ñ‚Ñ€Ð°ÐºÑ‚ Ð½Ð° 'Ð¿Ð¾Ð½Ð¸Ð¼Ð°Ð½Ð¸Ðµ Ð±ÐµÐ· Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ'. ÐšÐ»Ð¸ÐµÐ½Ñ‚ 'Ð¿Ð¾ÐºÑƒÐ¿Ð°ÐµÑ‚' Ð¸Ð½Ð´ÑƒÐ»ÑŒÐ³ÐµÐ½Ñ†Ð¸ÑŽ Ð½Ð° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ.";
            evolutionGoal = "Ð Ð¸ÑÐº Ð¶Ð¸Ð²Ð¾Ð³Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ.";
            evolutionProcess = "Ð’Ñ‹Ñ…Ð¾Ð´ Ð·Ð° Ð¿Ñ€ÐµÐ´ÐµÐ»Ñ‹ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾Ð³Ð¾ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ Ñ‡ÐµÑ€ÐµÐ· Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸ÑŽ Ð°Ð³Ñ€ÐµÑÑÐ¸Ð¸.";
            clinicalStrategy = ["1. Ð Ð°Ð±Ð¾Ñ‚Ð° Ñ Ð¢ÐµÐ½ÑŒÑŽ.", "2. ÐÐ½Ð°Ð»Ð¸Ð· Ð¿ÐµÑ€ÐµÐ½Ð¾ÑÐ°."];
        }
    } else {
        profileName = labels.stable;
        diffExpl = "áƒáƒšáƒ‘áƒáƒ—áƒáƒ‘áƒ áƒ’áƒáƒ›áƒáƒ—áƒ•áƒšáƒ˜áƒšáƒ˜áƒ áƒšáƒáƒ¢áƒ”áƒœáƒ¢áƒ£áƒ áƒáƒ‘áƒ˜áƒ¡ áƒ¡áƒáƒ¤áƒ£áƒ«áƒ•áƒ”áƒšáƒ–áƒ”.";
        validityExpl = "áƒ•áƒáƒšáƒ˜áƒ“áƒ£áƒ áƒáƒ‘áƒ˜áƒ¡ áƒáƒœáƒáƒšáƒ˜áƒ–áƒ˜.";
    }

    const systemicVectors: SystemicVector[] = [];
    const vectorNotes = {
        ru: "Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð½Ð°Ñ Ð»Ð¾ÑÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ â€” ÑÑ‚Ð¾ Ð±ÐµÑÑÐ¾Ð·Ð½Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð²ÐµÑ€Ð½Ð¾ÑÑ‚ÑŒ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÑŽ Ð¿Ñ€ÐµÐ´ÐºÐ¾Ð². Ð•ÑÐ»Ð¸ ÐºÐ»Ð¸ÐµÐ½Ñ‚ 'Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚' Ð±Ð¾Ð»ÑŒÑˆÐµ Ð·Ð°Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ñ‚ÑŒ Ð¸Ð»Ð¸ Ð±Ñ‹Ñ‚ÑŒ ÑÑ‡Ð°ÑÑ‚Ð»Ð¸Ð²Ñ‹Ð¼, Ð¾Ð½ 'Ð¿Ð»Ð°Ñ‚Ð¸Ñ‚ Ð´Ð¾Ð»Ð³' Ñ€Ð¾Ð´Ñƒ. Ð˜Ð½Ñ‚ÐµÑ€Ð²ÐµÐ½Ñ†Ð¸Ñ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ð½Ð°Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð° Ð½Ð° Ñ€Ð°Ð·Ñ€Ñ‹Ð² ÑÑ‚Ð¾Ð³Ð¾ ÐºÐ¾Ð½Ñ‚Ñ€Ð°ÐºÑ‚Ð° Ñ ÑƒÐ²Ð°Ð¶ÐµÐ½Ð¸ÐµÐ¼ Ðº Ð¿Ñ€ÐµÐ´ÐºÐ°Ð¼.",
        ka: "áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ£áƒ áƒ˜ áƒšáƒáƒ˜áƒáƒšáƒáƒ‘áƒ."
    }[lang];

    if (activePatterns.includes('family_loyalty') || state.foundation < 45) {
        systemicVectors.push({ 
            origin: 'SYSTEMIC_LOYALTY', 
            strength: activePatterns.includes('family_loyalty') ? 92 : 65, 
            description: lang === 'ru' ? "Ð’ÐµÑ€Ð½Ð¾ÑÑ‚ÑŒ Ñ€Ð¾Ð´Ð¾Ð²Ð¾Ð¼Ñƒ Ð´ÐµÑ„Ð¸Ñ†Ð¸Ñ‚Ñƒ." : "áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ£áƒ áƒ˜ áƒšáƒáƒ˜áƒáƒšáƒáƒ‘áƒ.",
            proNote: vectorNotes
        });
    }

    const interventions: Intervention[] = [];
    const lib = INTERVENTION_LIBRARY[lang];
    if (isCompensatoryOverdrive) interventions.push(lib.confrontation[0]);
    if (state.foundation < 30) interventions.push(lib.support[0]);
    if (interventions.length < 2) interventions.push(lib.systemic[0]);

    const diffMap = [
        { label: lang === 'ru' ? "ÐÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð°Ñ Ð´Ð¸ÑÑÐ¾Ñ†Ð¸Ð°Ñ†Ð¸Ñ" : "áƒáƒ¤áƒ”áƒ¥áƒ¢áƒ£áƒ áƒ˜ áƒ“áƒ˜áƒ¡áƒáƒªáƒ˜áƒáƒªáƒ˜áƒ", prob: neuroSync < 45 ? 0.85 : 0.15 },
        { label: lang === 'ru' ? "ÐÐ°Ñ€Ñ†Ð¸ÑÑÐ¸Ñ‡ÐµÑÐºÐ¾Ðµ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ðµ" : "áƒœáƒáƒ áƒªáƒ˜áƒ¡áƒ£áƒšáƒ˜ áƒ’áƒáƒ¤áƒáƒ áƒ—áƒáƒ”áƒ‘áƒ", prob: state.agency > 85 ? 0.85 : 0.1 },
        { label: lang === 'ru' ? "ÐœÐ°Ð½Ð¸Ð°ÐºÐ°Ð»ÑŒÐ½Ð°Ñ Ð·Ð°Ñ‰Ð¸Ñ‚Ð°" : "áƒ›áƒáƒœáƒ˜áƒáƒ™áƒáƒšáƒ£áƒ áƒ˜ áƒ“áƒáƒªáƒ•áƒ", prob: (state.agency > 75 && state.foundation < 40) ? 0.9 : 0.05 },
        { label: lang === 'ru' ? "Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð½Ð°Ñ Ð»Ð¾ÑÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ" : "áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ£áƒ áƒ˜ áƒšáƒáƒ˜áƒáƒšáƒáƒ‘áƒ", prob: activePatterns.includes('family_loyalty') ? 0.95 : 0.3 }
    ];

    const differentialHypotheses = diffMap
        .sort((a, b) => b.prob - a.prob)
        .map(h => ({ label: h.label, probability: h.prob }));

    const triggers: string[] = [];
    const focusLabel = isCompensatoryOverdrive ? labels.focus_false_self : 
                      state.foundation < 35 ? labels.focus_attachment : labels.focus_somatic;

    return {
        level1: {
            title: "CLINICAL SUMMARY",
            statusTag: profileName,
            summary: lang === 'ru' ? (isCompensatoryOverdrive ? "Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð² Ñ€ÐµÐ¶Ð¸Ð¼Ðµ ÑÐ²ÐµÑ€Ñ…ÐºÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ð¸." : "ÐÐ½Ð°Ð»Ð¸Ð· Ð²Ñ‹ÑÐ²Ð¸Ð» ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð½Ñ‹Ðµ Ð¾ÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸.") : "áƒ¡áƒ¢áƒ áƒ£áƒ¥áƒ¢áƒ£áƒ áƒ£áƒšáƒ˜ áƒáƒœáƒáƒšáƒ˜áƒ–áƒ˜.",
            focusQuestion: lang === 'ru' ? "ÐšÐ°ÐºÑƒÑŽ ÑƒÑÐ·Ð²Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð·Ð°Ñ‰Ð¸Ñ‰Ð°ÐµÑ‚ Ð²Ð°ÑˆÐ° ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ?" : "áƒ áƒáƒ¡ áƒ’áƒáƒ£áƒ áƒ‘áƒ˜áƒ®áƒáƒ áƒ—?",
            tone: state.foundation < 40 ? 'alert' : 'supportive',
            recommendation: focusLabel || "Ð¤Ð¾ÐºÑƒÑ Ð½Ð° Ñ‚ÐµÑ€Ð°Ð¿Ð¸Ð¸",
        },
        level2: {
            introduction: "ðŸ§¬ GENESIS OS // SUPERVISOR DOSSIER v3.5",
            generalConfig: `System Profile: ${profileName}.`,
            psychodynamicProfile,
            deepAnalysis: lang === 'ru' ? `ÐœÐµÑ…Ð°Ð½Ð¸ÐºÐ° ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹: ${psychodynamicProfile}` : "áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ˜áƒ¡ áƒ›áƒ”áƒ¥áƒáƒœáƒ˜áƒ™áƒ.",
            deepExpl,
            behaviorExpl,
            hypoExpl,
            interExpl,
            diffExpl,
            validityExpl, // NEW
            archetypeAnalysis: `Dominant: ${archetypeKey}.`,
            clinicalHypotheses: lang === 'ru' ? "1. Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¾Ñ‚Ð½Ð¾ÑˆÐµÐ½Ð¸Ðµ Ðº ÑÐµÐ±Ðµ. 2. Ð˜Ð·Ð±ÐµÐ³Ð°Ð½Ð¸Ðµ Ð±Ð»Ð¸Ð·Ð¾ÑÑ‚Ð¸ Ñ‡ÐµÑ€ÐµÐ· ÐºÐ¾Ð¼Ð¿ÐµÑ‚ÐµÐ½Ñ‚Ð½Ð¾ÑÑ‚ÑŒ." : "áƒ™áƒšáƒ˜áƒœáƒ˜áƒ™áƒ£áƒ áƒ˜ áƒ°áƒ˜áƒžáƒáƒ—áƒ”áƒ–áƒ”áƒ‘áƒ˜.",
            activePatterns: activePatterns.join(', '),
            verdictAndRecommendations: `${lang === 'ru' ? 'Ð’ÐµÑ€Ð´Ð¸ÐºÑ‚' : 'áƒ•áƒ”áƒ áƒ“áƒ˜áƒ¥áƒ¢áƒ˜'}: ${t.verdicts[verdictKey]?.label || verdictKey}.`,
            resistanceProfile: lang === 'ru' ? "Ð˜Ð½Ñ‚ÐµÐ»Ð»ÐµÐºÑ‚ÑƒÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¸ Ñ€Ð°Ñ†Ð¸Ð¾Ð½Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ." : "áƒ˜áƒœáƒ¢áƒ”áƒšáƒ”áƒ¥áƒ¢áƒ£áƒáƒšáƒ˜áƒ–áƒáƒªáƒ˜áƒ.",
            behavioralMarkers: lang === 'ru' ? "Ð‘Ñ‹ÑÑ‚Ñ€Ð°Ñ Ñ€ÐµÑ‡ÑŒ, Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ðµ Ð¿Ð°ÑƒÐ·, Ð¸Ð´ÐµÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ñ„Ð°ÑÐ°Ð´." : "áƒ¡áƒ¬áƒ áƒáƒ¤áƒ˜ áƒ¡áƒáƒ£áƒ‘áƒáƒ áƒ˜.",
            systemicRoot: lang === 'ru' ? "Ð—Ð°Ð¼ÐµÑ‰ÐµÐ½Ð¸Ðµ Ñ€Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÑÐºÐ¾Ð¹ Ñ„Ð¸Ð³ÑƒÑ€Ñ‹ ÑÐ¾Ð±ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ð¹ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒÑŽ." : "áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ£áƒ áƒ˜ áƒ¤áƒ”áƒ¡áƒ•áƒ˜.",
            therapeuticAlliance: lang === 'ru' ? "Ð Ð¸ÑÐº ÐºÐ¾Ð½ÐºÑƒÑ€ÐµÐ½Ñ†Ð¸Ð¸ Ð¸Ð»Ð¸ Ñ„Ð¾Ñ€Ð¼Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ñ‡ÐµÑÑ‚Ð²Ð°." : "áƒáƒšáƒ˜áƒáƒœáƒ¡áƒ˜áƒ¡ áƒ áƒ˜áƒ¡áƒ™áƒ˜.",
            shadowContract,
            evolutionGoal,
            shadowContractExpl, 
            evolutionProcess, 
            counterTransference,
            primaryDefense,
            therapeuticTrap,
            fragilityPoint,
            clinicalStrategy,
            triggers,
            blindSpots,
            sessionFlow: [
                { phase: 'ENTRY', title: lang === 'ru' ? 'ÐšÐ¾Ð½Ñ„Ñ€Ð¾Ð½Ñ‚Ð°Ñ†Ð¸Ñ' : 'áƒ™áƒáƒœáƒ¤áƒ áƒáƒœáƒ¢áƒáƒªáƒ˜áƒ', action: lang === 'ru' ? 'Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‚ Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸ Ð·Ð° Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð°.' : 'áƒ’áƒ áƒ«áƒœáƒáƒ‘áƒ”áƒ‘áƒ˜.' },
                { phase: 'EXPLORATION', title: lang === 'ru' ? 'ÐŸÐ¾Ð¸ÑÐº Ñ‚Ñ€ÐµÑ‰Ð¸Ð½Ñ‹' : 'áƒ‘áƒ–áƒáƒ áƒ˜', action: lang === 'ru' ? 'Ð“Ð´Ðµ Ð²Ñ‹ Ð½Ðµ ÑÐ¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ÐµÑÑŒ?' : 'áƒ¡áƒáƒ“ áƒ•áƒ”áƒ  áƒ£áƒ›áƒ™áƒšáƒáƒ•áƒ“áƒ”áƒ‘áƒ˜áƒ—?' },
                { phase: 'RESOLUTION', title: lang === 'ru' ? 'Ð›ÐµÐ³Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð±ÐµÑÑÐ¸Ð»Ð¸Ñ' : 'áƒ£áƒ¡áƒ£áƒ¡áƒ£áƒ áƒáƒ‘áƒ', action: lang === 'ru' ? 'Ð Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ Ð±Ñ‹Ñ‚ÑŒ ÑÐ»Ð°Ð±Ñ‹Ð¼.' : 'áƒ¡áƒ˜áƒ¡áƒ£áƒ¡áƒ¢áƒ˜áƒ¡ áƒ£áƒ¤áƒšáƒ”áƒ‘áƒ.' }
            ],
            clinicalProfile: `F:${state.foundation} A:${state.agency} R:${state.resource} E:${state.entropy}`,
            systemicVectors,
            interventions,
            differentialHypotheses
        },
    };
}


import { AnalysisResult, ClinicalNarrative, SystemicVector, Intervention } from '../types';
import { translations } from '../translations';

type Lang = 'ru' | 'ka';

const INTERVENTION_LIBRARY: Record<Lang, {
    systemic: Intervention[];
    confrontation: Intervention[];
    paradox: Intervention[];
    support: Intervention[];
}> = {
    ru: {
        systemic: [
            { type: 'SYSTEMIC_ORDER', text: "–Ø ‚Äî —ç—Ç–æ —è, –∞ –≤—ã ‚Äî —ç—Ç–æ –≤—ã. –Ø –æ—Å—Ç–∞–≤–ª—è—é –≤–∞–º –≤–∞—à—É —Å—É–¥—å–±—É.", purpose: "–†–∞–∑—Ä—ã–≤ –ø–∞—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏." },
            { type: 'SYSTEMIC_ORDER', text: "–Ø –¥–∞—é –º–µ—Å—Ç–æ –≤–∞—à–µ–π –±–æ–ª–∏, –Ω–æ —è –±–æ–ª—å—à–µ –Ω–µ –±—É–¥—É –ø–ª–∞—Ç–∏—Ç—å –∑–∞ –Ω–µ–µ —Å–≤–æ–µ–π –∂–∏–∑–Ω—å—é.", purpose: "–°–Ω—è—Ç–∏–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å –∂–µ—Ä—Ç–≤–æ–π." },
            { type: 'SYSTEMIC_ORDER', text: "–ú–∞–º–∞, –ø–∞–ø–∞, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –º–µ–Ω—è —Å –ª—é–±–æ–≤—å—é, –µ—Å–ª–∏ —è –±—É–¥—É –±–æ–≥–∞—á–µ –≤–∞—Å.", purpose: "–°–Ω—è—Ç–∏–µ –≤–∏–Ω—ã –∑–∞ —É—Å–ø–µ—Ö." }
        ],
        confrontation: [
            { type: 'CONFRONTATION', text: "–ü–æ—Ö–æ–∂–µ, –≤–∞—à–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± –Ω–µ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å, –∫–∞–∫ –≤–∞–º —Å—Ç—Ä–∞—à–Ω–æ.", purpose: "–í—Å–∫—Ä—ã—Ç–∏–µ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏." },
            { type: 'CONFRONTATION', text: "–ß—Ç–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏ –≤—ã –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç–µ —Å–ø–∞—Å–∞—Ç—å —ç—Ç–æ–≥–æ —Ç–µ—Ä–∞–ø–µ–≤—Ç–∞ —Å–≤–æ–∏–º–∏ —Ö–æ—Ä–æ—à–∏–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏?", purpose: "–†–∞–±–æ—Ç–∞ —Å –ø–µ—Ä–µ–Ω–æ—Å–æ–º." }
        ],
        paradox: [
            { type: 'PARADOX', text: "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ —Å–∞–±–æ—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–π —É—Å–ø–µ—Ö –µ—â–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ.", purpose: "–õ–µ–≥–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è." }
        ],
        support: [
            { type: 'SUPPORT', text: "–Ø –≤–∏–∂—É —Ç–≤–æ—é —É—Å—Ç–∞–ª–æ—Å—Ç—å. –¢—ã –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –≤ –æ–¥–∏–Ω–æ—á–∫—É –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.", purpose: "–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–µ—Ñ–∏—Ü–∏—Ç–∞." }
        ]
    },
    ka: {
        systemic: [
            { type: 'SYSTEMIC_ORDER', text: "·Éõ·Éî ·Éõ·Éî ·Éï·Éê·É†, ·Éó·É•·Éï·Éî·Éú ·Éô·Éò ·Éó·É•·Éï·Éî·Éú ·ÉÆ·Éê·É†·Éó. ·Éõ·Éî ·Éí·Éò·É¢·Éù·Éï·Éî·Éë·Éó ·Éó·É•·Éï·Éî·Éú·É° ·Éë·Éî·Éì·É°.", purpose: "·Éû·Éê·Éó·Éù·Éö·Éù·Éí·Éò·É£·É†·Éò ·Éö·Éù·Éò·Éê·Éö·Éù·Éë·Éò·É° ·Éí·Éê·É¨·Éß·Éï·Éî·É¢·Éê." }
        ],
        confrontation: [
            { type: 'CONFRONTATION', text: "·É†·Éù·Éí·Éù·É†·É™ ·É©·Éê·Éú·É°, ·Éó·É•·Éï·Éî·Éú·Éò ·Éî·É§·Éî·É•·É¢·É£·É†·Éù·Éë·Éê ·Éí·Éñ·Éê·Éê ·Éò·Éõ·Éò·É°·Éê·Éó·Éï·Éò·É°, ·É†·Éù·Éõ ·Éê·É† ·Éò·Éí·É†·É´·Éú·Éù·Éó ·É®·Éò·É®·Éò.", purpose: "·Éô·Éù·Éõ·Éû·Éî·Éú·É°·Éê·É™·Éò·Éò·É° ·Éí·Éê·ÉÆ·É°·Éú·Éê." }
        ],
        paradox: [
            { type: 'PARADOX', text: "·É°·É™·Éê·Éì·Éî·Éó ·Éê·Éõ ·Éô·Éï·Éò·É†·Éê·É®·Éò ·Éô·Éò·Éì·Éî·Éï ·É£·É§·É†·Éù ·Éî·É§·Éî·É•·É¢·É£·É†·Éê·Éì ·Éõ·Éù·Éê·ÉÆ·Éì·Éò·Éú·Éù·Éó ·Éó·É•·Éï·Éî·Éú·Éò ·É¨·Éê·É†·Éõ·Éê·É¢·Éî·Éë·Éò·É° ·É°·Éê·Éë·Éù·É¢·Éê·Éü·Éò.", purpose: "·É¨·Éò·Éú·Éê·Éê·É¶·Éõ·Éì·Éî·Éí·Éù·Éë·Éò·É° ·Éö·Éî·Éí·Éê·Éö·Éò·Éñ·Éê·É™·Éò·Éê." }
        ],
        support: [
            { type: 'SUPPORT', text: "·Éõ·Éî ·Éï·ÉÆ·Éî·Éì·Éê·Éï ·É®·Éî·Éú·É° ·Éì·Éê·É¶·Éö·Éò·Éö·Éù·Éë·Éê·É°.", purpose: "·Éï·Éê·Éö·Éò·Éì·Éê·É™·Éò·Éê." }
        ]
    }
};

export function generateClinicalNarrative(result: AnalysisResult, lang: Lang): ClinicalNarrative {
    const t = translations[lang];
    const { state, neuroSync, activePatterns, archetypeKey, verdictKey, correlations } = result;

    let psychodynamicProfile = "";
    let counterTransference = "";
    let primaryDefense = "";
    let therapeuticTrap = "";
    let fragilityPoint = "";
    let profileName = "";
    let clinicalStrategy: string[] = [];
    let blindSpots: string[] = [];

    // DETECTING "GOD MODE" / COMPENSATORY OVERDRIVE
    const isCompensatoryOverdrive = state.agency > 85 && state.resource > 85 && state.entropy < 15;

    if (lang === 'ru') {
        if (isCompensatoryOverdrive) {
            profileName = "ARMORED_DEFENSE";
            psychodynamicProfile = "–ö–õ–ò–ù–ò–ß–ï–°–ö–ò–ô –ü–ê–†–ê–î–û–ö–°: –°–∏—Å—Ç–µ–º–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç '–∏–¥–µ–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ' (–≤—ã—Å–æ–∫–∞—è –í–æ–ª—è, –≤—ã—Å–æ–∫–∏–π –†–µ—Å—É—Ä—Å, –Ω—É–ª–µ–≤–∞—è –¢—Ä–µ–≤–æ–≥–∞), —á—Ç–æ –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ. –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –º–∞—Å—Å–∏–≤–Ω–æ–µ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ –∞—Ñ—Ñ–µ–∫—Ç–æ–≤. –ö–ª–∏–µ–Ω—Ç '–∑–∞–º–æ—Ä–æ–∑–∏–ª' —Å–≤–æ—é —É—è–∑–≤–∏–º–æ—Å—Ç—å –≤ –±–µ—Ç–æ–Ω –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π. –û–Ω –Ω–µ —á—É–≤—Å—Ç–≤—É–µ—Ç –±–æ–ª–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ—Ç–∫–ª—é—á–∏–ª —Ä–µ—Ü–µ–ø—Ç–æ—Ä—ã. –≠—Ç–æ –Ω–µ –∑–¥–æ—Ä–æ–≤—å–µ, —ç—Ç–æ –±—É–Ω–∫–µ—Ä.";
            counterTransference = "–í—ã –º–æ–∂–µ—Ç–µ –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–µ–±—è –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã–º –∏–ª–∏ —Å–∫—É—á–∞—é—â–∏–º. –í–æ–∑–Ω–∏–∫–∞–µ—Ç –∂–µ–ª–∞–Ω–∏–µ –ª–∏–±–æ –≤–æ—Å—Ö–∏—â–∞—Ç—å—Å—è –∫–ª–∏–µ–Ω—Ç–æ–º (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—è –µ–≥–æ –∑–∞—â–∏—Ç—É), –ª–∏–±–æ –∫–æ–Ω–∫—É—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –Ω–∏–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ. –û—â—É—â–µ–Ω–∏–µ '–≥–ª–∞–¥–∫–æ–π —Å—Ç–µ–Ω—ã', –∑–∞ –∫–æ—Ç–æ—Ä—É—é –Ω–µ –∑–∞—Ü–µ–ø–∏—Ç—å—Å—è.";
            primaryDefense = "–í—Å–µ–º–æ–≥—É—â–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å + –ò–¥–µ–∞–ª–∏–∑–∞—Ü–∏—è (—Å–µ–±—è) + –û—Ç—Ä–∏—Ü–∞–Ω–∏–µ (—Å–ª–∞–±–æ—Å—Ç–∏).";
            therapeuticTrap = "–°–æ–±–ª–∞–∑–Ω–µ–Ω–∏–µ –∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é. –ö–ª–∏–µ–Ω—Ç –±—É–¥–µ—Ç '—Ö–æ—Ä–æ—à–∏–º –ø–∞—Ü–∏–µ–Ω—Ç–æ–º', –ø—Ä–∏–Ω–æ—Å–∏—Ç—å –∏–Ω—Å–∞–π—Ç—ã –∏ –¥–µ–ª–∞—Ç—å –¥–æ–º–∞—à–∫–∏, –ª–∏—à—å –±—ã –Ω–µ —Å–æ–ø—Ä–∏–∫–∞—Å–∞—Ç—å—Å—è —Å —Ä–µ–∞–ª—å–Ω–æ–π –±–æ–ª—å—é. –ï—Å–ª–∏ –≤—ã –Ω–∞—á–Ω–µ—Ç–µ –µ–≥–æ —Ö–≤–∞–ª–∏—Ç—å ‚Äî –≤—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏, –∑–∞—â–∏—Ç–∞ —É–∫—Ä–µ–ø–∏–ª–∞—Å—å.";
            fragilityPoint = "–°—Ç—Ä–∞—Ö –æ—à–∏–±–∫–∏ / –°—Ç—ã–¥ –Ω–µ—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–∞. –õ—é–±–æ–π, –¥–∞–∂–µ –º–∏–∫—Ä–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–≤–∞–ª –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –∫–∞–∫ —Ç–æ—Ç–∞–ª—å–Ω–æ–µ —Ä–∞–∑—Ä—É—à–µ–Ω–∏–µ –Ø (–ø—Å–∏—Ö–æ—Ç–∏—á–µ—Å–∫–∞—è –∞–Ω–Ω–∏–≥–∏–ª—è—Ü–∏—è).";
            clinicalStrategy = [
                "1. –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –Ω–∞—Ä—Ü–∏—Å—Å–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ ('–≤—ã —Ç–∞–∫–æ–π –º–æ–ª–æ–¥–µ—Ü').",
                "2. –ò—Å–∫–∞—Ç—å –º–∏–∫—Ä–æ-—Ç—Ä–µ—â–∏–Ω—ã: –º–æ–º–µ–Ω—Ç—ã —É—Å—Ç–∞–ª–æ—Å—Ç–∏, —Å–æ–º–Ω–µ–Ω–∏–π, —Ç–µ–ª–µ—Å–Ω–æ–≥–æ –¥–∏—Å–∫–æ–º—Ñ–æ—Ä—Ç–∞.",
                "3. –õ–µ–≥–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞—Å—Å–∏–≤–Ω–æ—Å—Ç—å: '–ê —á—Ç–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏ –≤—ã —Å–µ–≥–æ–¥–Ω—è –Ω–∏—á–µ–≥–æ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç–µ?'",
                "4. –ö–æ–Ω—Ñ—Ä–æ–Ω—Ç–∞—Ü–∏—è —Å '–ª–æ–∂–Ω—ã–º –Ø': '–ü–æ—Ö–æ–∂–µ, –≤–∞—à–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± –Ω–µ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ.'"
            ];
            blindSpots = [
                "–ò—Å—Ç–∏–Ω–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ –¥–µ–ø—Ä–µ—Å—Å–∏–≤–Ω–æ–≥–æ –∞—Ñ—Ñ–µ–∫—Ç–∞ (—Å–∫—Ä—ã—Ç–∞ —Ñ–∞—Å–∞–¥–æ–º).",
                "–ü—Å–∏—Ö–æ—Å–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ü–µ–Ω–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π (—Å–∏—Å—Ç–µ–º–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –∏–∑–Ω–æ—Å).",
                "–ö–∞—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∑–∞–º–µ–Ω—è–µ—Ç –±–ª–∏–∑–æ—Å—Ç—å)."
            ];
        } else if (state.foundation < 30) {
            profileName = "CRITICAL_DEFICIT";
            psychodynamicProfile = "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ '–ì–æ–ª—ã–π –ü—Ä–æ–≤–æ–¥'. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –¥–µ—Ñ–∏—Ü–∏—Ç –ë–∞–∑–æ–≤–æ–≥–æ –î–æ–≤–µ—Ä–∏—è. –≠–≥–æ-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫—Ä–∞–π–Ω–µ —Ö—Ä—É–ø–∫–∞—è. –õ—é–±–æ–π —Å—Ç—Ä–µ—Å—Å –±—å–µ—Ç –Ω–∞–ø—Ä—è–º—É—é –ø–æ —è–¥—Ä—É –ª–∏—á–Ω–æ—Å—Ç–∏ –±–µ–∑ –∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏–∏. –ö–ª–∏–µ–Ω—Ç –∂–∏–≤–µ—Ç –≤ —Ä–µ–∂–∏–º–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –≤—ã–∂–∏–≤–∞–Ω–∏—è, –¥–∞–∂–µ –µ—Å–ª–∏ –≤–Ω–µ—à–Ω–µ —Å–ø–æ–∫–æ–µ–Ω.";
            counterTransference = "–°–∏–ª—å–Ω–æ–µ –∂–µ–ª–∞–Ω–∏–µ '—Å–ø–∞—Å—Ç–∏', '–Ω–∞–∫–æ—Ä–º–∏—Ç—å', '—É—Å—ã–Ω–æ–≤–∏—Ç—å'. –õ–∏–±–æ, –Ω–∞–æ–±–æ—Ä–æ—Ç, –∑–ª–æ—Å—Ç—å –∏ –±–µ—Å—Å–∏–ª–∏–µ –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ '–≤ —á–µ—Ä–Ω—É—é –¥—ã—Ä—É —Å–∫–æ–ª—å–∫–æ –Ω–∏ –ª–µ–π, –≤—Å—ë –º–∞–ª–æ'.";
            primaryDefense = "–ü—Ä–æ–µ–∫—Ç–∏–≤–Ω–∞—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è / –†–∞—Å—â–µ–ø–ª–µ–Ω–∏–µ.";
            therapeuticTrap = "–†–µ–ø–∞—Ä–µ–Ω—Ç–∏–Ω–≥ –±–µ–∑ –≥—Ä–∞–Ω–∏—Ü. –í—ã —Ä–∏—Å–∫—É–µ—Ç–µ —Å—Ç–∞—Ç—å '–ª—É—á—à–µ–π –º–∞–º–æ–π', —á–µ–º –∏—Å—Ç–æ—â–∏—Ç–µ —Å–µ–±—è –∏ –∏–Ω—Ñ–∞–Ω—Ç–∏–ª–∏–∑–∏—Ä—É–µ—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞, –Ω–µ –Ω–∞—É—á–∏–≤ –µ–≥–æ –æ–ø–∏—Ä–∞—Ç—å—Å—è –Ω–∞ —Å–µ–±—è.";
            fragilityPoint = "–°—Ç—Ä–∞—Ö –ø–æ–≥–ª–æ—â–µ–Ω–∏—è –∏–ª–∏ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è. –°—Ç—Ä–∞—Ö, —á—Ç–æ '–º–µ–Ω—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'.";
            clinicalStrategy = [
                "1. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç ‚Ññ1: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ç—Ç–∏–Ω–≥–∞.",
                "2. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∞–≤–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏.",
                "3. –ü–æ–∏—Å–∫ –ª—é–±—ã—Ö (–¥–∞–∂–µ –º–∞–ª—ã—Ö) –≤–Ω–µ—à–Ω–∏—Ö –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –æ–ø–æ—Ä.",
                "4. –ò–∑–±–µ–≥–∞—Ç—å –ø—Ä–æ–≤–æ–∫–∞—Ç–∏–≤–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –∏ –∂–µ—Å—Ç–∫–æ–π –∫–æ–Ω—Ñ—Ä–æ–Ω—Ç–∞—Ü–∏–∏."
            ];
            blindSpots = [
                "–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª –∞–≥—Ä–µ—Å—Å–∏–∏ (–ø–æ–¥–∞–≤–ª–µ–Ω —Å—Ç—Ä–∞—Ö–æ–º —Ä–∞–∑—Ä—É—à–∏—Ç—å –æ–±—ä–µ–∫—Ç).",
                "–†–µ–∞–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã (–∫–ª–∏–µ–Ω—Ç –∏—Ö –æ–±–µ—Å—Ü–µ–Ω–∏–≤–∞–µ—Ç –∏–ª–∏ –Ω–µ –≤–∏–¥–∏—Ç)."
            ];
        } else if (state.agency > 80 && state.foundation < 45) {
            profileName = "MANIC_DRIVE";
            psychodynamicProfile = "–ú–∞–Ω–∏–∞–∫–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–ø—Ä–µ—Å—Å–∏–∏ ('–ë–µ–≥—Å—Ç–≤–æ –≤ –∑–¥–æ—Ä–æ–≤—å–µ'). –ö–ª–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—Ç–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –æ–ø–æ—Ä—ã. –ü–æ–∫–∞ –æ–Ω –±–µ–∂–∏—Ç ‚Äî –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–≤–Ω–∞ —Å–º–µ—Ä—Ç–∏. –í–Ω—É—Ç—Ä–∏ ‚Äî –æ–≥—Ä–æ–º–Ω–∞—è –¥–µ–ø—Ä–µ—Å—Å–∏–≤–Ω–∞—è –≤–æ—Ä–æ–Ω–∫–∞.";
            counterTransference = "–£—Å—Ç–∞–ª–æ—Å—Ç—å –æ—Ç —Ç–µ–º–ø–∞ –∫–ª–∏–µ–Ω—Ç–∞. –û—â—É—â–µ–Ω–∏–µ, —á—Ç–æ –≤–∞—Å –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—é/–∑–µ—Ä–∫–∞–ª–æ. –¢—Ä—É–¥–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å —Å–ª–æ–≤–æ. –í–∞—Å '–º–Ω–æ–≥–æ', –Ω–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –Ω–µ—Ç.";
            primaryDefense = "–ú–∞–Ω–∏–∞–∫–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ (Acting Out) / –û—Ç—Ä–∏—Ü–∞–Ω–∏–µ.";
            therapeuticTrap = "–ü–æ–¥–¥–µ—Ä–∂–∫–∞ '—É—Å–ø–µ—Ö–∞'. –ï—Å–ª–∏ –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ –Ω–∞ –µ–≥–æ —Ü–µ–ª–∏, –≤—ã —É–∫—Ä–µ–ø–ª—è–µ—Ç–µ —Ñ–∞—Å–∞–¥. –ï—Å–ª–∏ –≤—ã —Ç–æ—Ä–º–æ–∑–∏—Ç–µ –µ–≥–æ —Å–ª–∏—à–∫–æ–º —Ä–µ–∑–∫–æ ‚Äî –æ–Ω —É–π–¥–µ—Ç –∏–∑ —Ç–µ—Ä–∞–ø–∏–∏.";
            fragilityPoint = "–í—ã–Ω—É–∂–¥–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ (–±–æ–ª–µ–∑–Ω—å, —É–≤–æ–ª—å–Ω–µ–Ω–∏–µ, —Ä–∞–∑–≤–æ–¥) ‚Äî —Ä–∏—Å–∫ —Å—É–∏—Ü–∏–¥–∞–ª—å–Ω—ã—Ö –º—ã—Å–ª–µ–π.";
            clinicalStrategy = [
                "1. –ê–∫–∫—É—Ä–∞—Ç–Ω–æ–µ –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ ('–î–∞–≤–∞–π—Ç–µ –∑–¥–µ—Å—å –æ—Å—Ç–∞–Ω–æ–≤–∏–º—Å—è –∏ –ø–æ–¥—ã—à–∏–º').",
                "2. –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π —Å —á—É–≤—Å—Ç–≤–∞–º–∏, –æ—Ç –∫–æ—Ç–æ—Ä—ã—Ö –æ–Ω –±–µ–∂–∏—Ç.",
                "3. –†–∞–±–æ—Ç–∞ —Å —Ç–µ–ª–æ–º (–∑–∞–∑–µ–º–ª–µ–Ω–∏–µ), —Ç–∞–∫ –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç –∂–∏–≤–µ—Ç –≤ –≥–æ–ª–æ–≤–µ.",
                "4. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –Ω–µ–∏–∑–±–µ–∂–Ω–æ–º—É —Å–ø–∞–¥—É ('–¥–µ–ø—Ä–µ—Å—Å–∏–≤–Ω–æ–π –ø–æ—Å–∞–¥–∫–µ')."
            ];
            blindSpots = [
                "–ß—É–≤—Å—Ç–≤–æ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–∞ (–∑–∞–≥–ª—É—à–µ–Ω–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é).",
                "–ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–æ—Ç–≤–µ—Ä–≥–∞–µ—Ç—Å—è –∫–∞–∫ —Å–ª–∞–±–æ—Å—Ç—å)."
            ];
        } else if (neuroSync < 40) {
            profileName = "DISSOCIATED";
            psychodynamicProfile = "–ê–ª–µ–∫—Å–∏—Ç–∏–º–∏—á–µ—Å–∫–∏–π —Ä–∞–¥–∏–∫–∞–ª. –†–∞–∑—Ä—ã–≤ —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∞—Ñ—Ñ–µ–∫—Ç–æ–º –∏ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º. –¢–µ–ª–æ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –∫–∞–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç ('—Ç–∞–∫—Å–∏ –¥–ª—è –º–æ–∑–≥–∞') –∏–ª–∏ –ø–æ–º–µ—Ö–∞. –í–µ—Ä–æ—è—Ç–Ω–æ –Ω–∞–ª–∏—á–∏–µ —Ä–∞–Ω–Ω–µ–π —Ç—Ä–∞–≤–º—ã –æ—Ç–≤–µ—Ä–∂–µ–Ω–∏—è.";
            counterTransference = "–°–∫—É–∫–∞, —Å–æ–Ω–ª–∏–≤–æ—Å—Ç—å, –æ—â—É—â–µ–Ω–∏–µ '–≤–∞—Ç–Ω–æ–π —Å—Ç–µ–Ω—ã'. –í—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–µ–±—è —Ä–æ–±–æ—Ç–æ–º –∏–ª–∏ —Å–ø—Ä–∞–≤–æ—á–Ω—ã–º –±—é—Ä–æ. –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ö–æ–ª–æ–¥.";
            primaryDefense = "–ò–∑–æ–ª—è—Ü–∏—è –∞—Ñ—Ñ–µ–∫—Ç–∞ / –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è.";
            therapeuticTrap = "–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–≥–æ–≤–æ—Ä. –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ —É–º–Ω—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã '–æ –ø—Ä–æ–±–ª–µ–º–µ' –±–µ–∑ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è —ç–º–æ—Ü–∏–π. '–ú—ã –≤—Å–µ –ø–æ–Ω—è–ª–∏, –Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å'.";
            fragilityPoint = "–ü—Å–∏—Ö–æ—Å–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å—Ä—ã–≤ (—Ç–µ–ª–æ —Å–∫–∞–∂–µ—Ç —Ç–æ, —á—Ç–æ –º–æ–ª—á–∏—Ç —Ä–æ—Ç).";
            clinicalStrategy = [
                "1. –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç –∫ '–∑–¥–µ—Å—å –∏ —Å–µ–π—á–∞—Å' –∏ —Ç–µ–ª–µ—Å–Ω—ã–º –æ—â—É—â–µ–Ω–∏—è–º.",
                "2. –û–±—É—á–µ–Ω–∏–µ —Å–ª–æ–≤–∞—Ä—é —ç–º–æ—Ü–∏–π.",
                "3. –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ '—É–º–Ω—ã—Ö' –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∫–ª–∏–µ–Ω—Ç–∞, —Ñ–æ–∫—É—Å –Ω–∞ –Ω–µ–≤–µ—Ä–±–∞–ª–∏–∫–µ.",
                "4. –ü—Ä–æ–≤–æ–∫–∞—Ü–∏—è –∂–∏–≤–æ–π —Ä–µ–∞–∫—Ü–∏–∏ (–¥–∞–∂–µ –∑–ª–æ—Å—Ç–∏) –¥–ª—è –ø—Ä–æ—Ä—ã–≤–∞ –±–ª–æ–∫–∞."
            ];
            blindSpots = [
                "–†–µ–∞–ª—å–Ω—ã–π —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –æ—Ç–∫–ª–∏–∫ (–ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω).",
                "–ò–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã –æ–ø–∞—Å–Ω–æ—Å—Ç–∏."
            ];
        } else if (state.entropy > 60) {
            profileName = "CHAOTIC_FLUX";
            psychodynamicProfile = "–î–∏—Ñ—Ñ—É–∑–Ω–∞—è —Ç—Ä–µ–≤–æ–≥–∞, –∑–∞—Ç–∞–ø–ª–∏–≤–∞—é—â–∞—è –≠–≥–æ. –ì—Ä–∞–Ω–∏—Ü—ã —Ä–∞–∑–º—ã—Ç—ã. –ö–ª–∏–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–º–ø—É–ª—å—Å—ã. –í–æ–∑–º–æ–∂–Ω–∞ –ø–æ–≥—Ä–∞–Ω–∏—á–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ª–∏—á–Ω–æ—Å—Ç–∏.";
            counterTransference = "–¢—Ä–µ–≤–æ–≥–∞, –ø—É—Ç–∞–Ω–∏—Ü–∞, —Ö–∞–æ—Å. –ñ–µ–ª–∞–Ω–∏–µ –∂–µ—Å—Ç–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Å—Å–∏—é, –¥–∞—Ç—å —Å–æ–≤–µ—Ç—ã, –Ω–∞–≤–µ—Å—Ç–∏ –ø–æ—Ä—è–¥–æ–∫.";
            primaryDefense = "–û—Ç—ã–≥—Ä—ã–≤–∞–Ω–∏–µ –≤–æ–≤–Ω–µ (Acting Out) / –ü—Ä–æ–µ–∫—Ü–∏—è.";
            therapeuticTrap = "–°–ø–∞—Å–∞—Ç–µ–ª—å—Å—Ç–≤–æ –≤ —Ö–∞–æ—Å–µ. –ü–æ–ø—ã—Ç–∫–∞ —Å—Ç–∞—Ç—å –≤–Ω–µ—à–Ω–∏–º –º–æ–∑–≥–æ–º –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞, –ø—Ä–∏–Ω–∏–º–∞—è —Ä–µ—à–µ–Ω–∏—è –∑–∞ –Ω–µ–≥–æ.";
            fragilityPoint = "–°—Ç—Ä–∞—Ö –ø–æ—Ç–µ—Ä–∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –∏ —Å–æ–π—Ç–∏ —Å —É–º–∞.";
            clinicalStrategy = [
                "1. –ñ–µ—Å—Ç–∫–∏–π —Å–µ—Ç—Ç–∏–Ω–≥ –∏ –≥—Ä–∞–Ω–∏—Ü—ã.",
                "2. –ö–æ–Ω—Ç–µ–π–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–≤–æ–≥–∏ (–±—ã—Ç—å —Å–ø–æ–∫–æ–π–Ω—ã–º –æ–±—ä–µ–∫—Ç–æ–º –≤ —à—Ç–æ—Ä–º–µ).",
                "3. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ö–∞–æ—Å–∞: –Ω–∞–∑—ã–≤–∞–Ω–∏–µ –≤–µ—â–µ–π —Å–≤–æ–∏–º–∏ –∏–º–µ–Ω–∞–º–∏.",
                "4. –†–∞–±–æ—Ç–∞ —Å –∏–º–ø—É–ª—å—Å–∏–≤–Ω–æ—Å—Ç—å—é."
            ];
            blindSpots = [
                "–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –¥–µ–π—Å—Ç–≤–∏–π.",
                "–í–ª–∏—è–Ω–∏–µ —Ö–∞–æ—Å–∞ –Ω–∞ –æ–∫—Ä—É–∂–∞—é—â–∏—Ö."
            ];
        } else {
            profileName = "STABLE_FLOW";
            psychodynamicProfile = "–ù–µ–≤—Ä–æ—Ç–∏—á–µ—Å–∫–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ª–∏—á–Ω–æ—Å—Ç–∏ —Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π. –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ª–µ–∂–∏—Ç –≤ –ø–ª–æ—Å–∫–æ—Å—Ç–∏ '–•–æ—á—É vs –ù–∞–¥–æ' –∏–ª–∏ '–î–æ–ª–≥ vs –£–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ', –∞ –Ω–µ –≤ –ø–ª–æ—Å–∫–æ—Å—Ç–∏ –≤—ã–∂–∏–≤–∞–Ω–∏—è.";
            counterTransference = "–†–∞–±–æ—á–∏–π –∞–ª—å—è–Ω—Å. –û—â—É—â–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞, –Ω–æ –≤–æ–∑–º–æ–∂–Ω–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è –∑–∞ –≤–ª–∞—Å—Ç—å.";
            primaryDefense = "–†–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è / –í—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ.";
            therapeuticTrap = "–†—É—Ç–∏–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞. –¢–µ—Ä–∞–ø–∏—è –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å '–ø—Ä–∏—è—Ç–Ω–æ–π –±–µ—Å–µ–¥–æ–π' –±–µ–∑ –≥–ª—É–±–∏–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.";
            fragilityPoint = "–°–∏—Ç—É–∞—Ç–∏–≤–Ω—ã–π —Å—Ç—Ä–µ—Å—Å –∏ –∫—Ä–∏–∑–∏—Å—ã —Å–º—ã—Å–ª–æ–≤.";
            clinicalStrategy = [
                "1. –†–∞–±–æ—Ç–∞ —Å –∑–∞–ø—Ä–æ—Å–æ–º –Ω–∞ –≥–ª—É–±–∏–Ω—É –∏ —Å–º—ã—Å–ª—ã.",
                "2. –ê–Ω–∞–ª–∏–∑ –ø–µ—Ä–µ–Ω–æ—Å–∞ –∏ –∫–æ–Ω—Ç—Ä–ø–µ—Ä–µ–Ω–æ—Å–∞.",
                "3. –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ç–µ–Ω–µ–≤—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ –ª–∏—á–Ω–æ—Å—Ç–∏.",
                "4. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–≤—Ç–æ–Ω–æ–º–∏–∏."
            ];
            blindSpots = [
                "–¢–µ–Ω–µ–≤—ã–µ –∞—Å–ø–µ–∫—Ç—ã (—Å–ª–∏—à–∫–æ–º —Ö–æ—Ä–æ—à–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è —Å–∫—Ä—ã–≤–∞–µ—Ç –°–∞–º–æ—Å—Ç—å)."
            ];
        }
    } else {
        // GEORGIAN GENERATION LOGIC (Simplified fallback)
        profileName = "·É°·É¢·Éê·Éë·Éò·Éö·É£·É†·Éò";
        psychodynamicProfile = "·É§·É°·Éò·É•·Éù·Éì·Éò·Éú·Éê·Éõ·Éò·Éô·É£·É†·Éò ·Éû·É†·Éù·É§·Éò·Éö·Éò ·Éí·Éî·Éú·Éî·É†·Éò·É†·Éì·Éî·Éë·Éê...";
        counterTransference = "·Éô·Éù·Éú·É¢·É†·Éí·Éê·Éì·Éê·É¢·Éê·Éú·Éê...";
        primaryDefense = "·Éì·Éê·É™·Éï·Éò·É° ·Éõ·Éî·É•·Éê·Éú·Éò·Éñ·Éõ·Éî·Éë·Éò...";
        therapeuticTrap = "·Éó·Éî·É†·Éê·Éû·Éò·É£·Éö·Éò ·Éõ·Éê·ÉÆ·Éî...";
        fragilityPoint = "·É°·Éò·É°·É£·É°·É¢·Éò·É° ·É¨·Éî·É†·É¢·Éò·Éö·Éò...";
        clinicalStrategy = ["·É°·É¢·É†·Éê·É¢·Éî·Éí·Éò·Éê ·Éõ·É£·É®·Éê·Éï·Éì·Éî·Éë·Éê..."];
        blindSpots = ["·É°·Éò·É°·É¢·Éî·Éõ·É£·É†·Éò ·Éë·É†·Éõ·Éê ·Éö·Éê·É•·Éî·Éë·Éò..."];
    }

    // --- SYSTEMIC VECTOR CALCULATION ---
    const systemicVectors: SystemicVector[] = [];
    if (activePatterns.includes('family_loyalty') || state.foundation < 45) {
        systemicVectors.push({ 
            origin: 'SYSTEMIC', 
            strength: activePatterns.includes('family_loyalty') ? 92 : 65, 
            description: lang === 'ru' ? "–õ–æ—è–ª—å–Ω–æ—Å—Ç—å —Ä–æ–¥–æ–≤–æ–º—É —Å—Ü–µ–Ω–∞—Ä–∏—é –¥–µ—Ñ–∏—Ü–∏—Ç–∞." : "·É°·Éò·É°·É¢·Éî·Éõ·É£·É†·Éò ·Éö·Éù·Éò·Éê·Éö·Éù·Éë·Éê." 
        });
    }
    if (state.foundation < 35) {
        systemicVectors.push({ 
            origin: 'MATERNAL', 
            strength: 85, 
            description: lang === 'ru' ? "–î–µ—Ñ–∏—Ü–∏—Ç –±–∞–∑–æ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–º–∞—Ç–µ—Ä–∏–Ω—Å–∫–∏–π –æ–±—ä–µ–∫—Ç)." : "·Éë·Éê·Éñ·Éò·É°·É£·É†·Éò ·Éú·Éì·Éù·Éë·Éò·É° ·Éì·Éî·É§·Éò·É™·Éò·É¢·Éò." 
        });
    }
    if (state.agency > 80 && state.foundation < 40) {
        systemicVectors.push({ 
            origin: 'PATERNAL', 
            strength: 75, 
            description: lang === 'ru' ? "–ü–æ–∏—Å–∫ –ø—Ä–∏–∑–Ω–∞–Ω–∏—è —á–µ—Ä–µ–∑ —Å–≤–µ—Ä—Ö-–¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è." : "·Éê·É¶·Éò·Éê·É†·Éî·Éë·Éò·É° ·É´·Éò·Éî·Éë·Éê ·Éõ·Éò·É¶·É¨·Éî·Éï·Éî·Éë·Éò·Éó." 
        });
    }

    // --- INTERVENTION SELECTION ---
    const interventions: Intervention[] = [];
    const lib = INTERVENTION_LIBRARY[lang];
    
    if (state.agency > 85 && state.foundation < 40) interventions.push(lib.confrontation[0]);
    if (activePatterns.includes('family_loyalty')) interventions.push(lib.systemic[1]);
    if (activePatterns.includes('poverty_is_virtue')) interventions.push(lib.systemic[2]);
    if (state.entropy > 50) interventions.push(lib.paradox[0]);
    if (state.foundation < 30) interventions.push(lib.support[0]);
    if (interventions.length < 2) interventions.push(lib.systemic[0]);

    // --- DIFFERENTIAL HYPOTHESES ---
    const diffMap = [
        { label: lang === 'ru' ? "–ê—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –¥–∏—Å—Å–æ—Ü–∏–∞—Ü–∏—è" : "·Éê·É§·Éî·É•·É¢·É£·É†·Éò ·Éì·Éò·É°·Éù·É™·Éò·Éê·É™·Éò·Éê", prob: neuroSync < 45 ? 0.85 : 0.15 },
        { label: lang === 'ru' ? "–ù–∞—Ä—Ü–∏—Å—Å–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ" : "·Éú·Éê·É†·É™·Éò·É°·É£·Éö·Éò ·Éí·Éê·É§·Éê·É†·Éó·Éù·Éî·Éë·Éê", prob: state.agency > 85 ? 0.85 : 0.1 },
        { label: lang === 'ru' ? "–ú–∞–Ω–∏–∞–∫–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞" : "·Éõ·Éê·Éú·Éò·Éê·Éô·Éê·Éö·É£·É†·Éò ·Éì·Éê·É™·Éï·Éê", prob: (state.agency > 75 && state.foundation < 40) ? 0.9 : 0.05 },
        { label: lang === 'ru' ? "–°–∏—Å—Ç–µ–º–Ω–∞—è –ª–æ—è–ª—å–Ω–æ—Å—Ç—å" : "·É°·Éò·É°·É¢·Éî·Éõ·É£·É†·Éò ·Éö·Éù·Éò·Éê·Éö·Éù·Éë·Éê", prob: activePatterns.includes('family_loyalty') ? 0.95 : 0.3 },
        { label: lang === 'ru' ? "–î–µ—Ñ–∏—Ü–∏—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏" : "·Éò·Éì·Éî·Éú·É¢·Éù·Éë·Éò·É° ·Éì·Éî·É§·Éò·É™·Éò·É¢·Éò", prob: archetypeKey === 'THE_DRIFTER' ? 0.7 : 0.2 }
    ];

    const differentialHypotheses = diffMap
        .sort((a, b) => b.prob - a.prob)
        .map(h => ({ label: h.label, probability: h.prob }));

    // --- TRIGGER MAPPING (GRANULARITY) ---
    const triggers: string[] = [];
    if (correlations && correlations.length > 0) {
        correlations.forEach(c => {
            const rawKey = c.descriptionKey.replace('correlation_resistance_', '').replace('correlation_resonance_', '');
            const patternName = t.beliefs[rawKey] || rawKey;
            const typeLabel = c.type === 'resistance' ? (lang === 'ru' ? "–ë–õ–û–ö/–ó–ê–î–ï–†–ñ–ö–ê" : "·Éë·Éö·Éù·Éô·Éò") : (lang === 'ru' ? "–†–ï–ó–û–ù–ê–ù–°" : "·É†·Éî·Éñ·Éù·Éú·Éê·Éú·É°·Éò");
            const domainLabel = t.domains[c.domain]?.toUpperCase() || c.domain.toUpperCase();
            triggers.push(`${domainLabel} ‚ûî ${patternName} (${typeLabel})`);
        });
    }

    return {
        level1: {
            title: "CLINICAL SUMMARY",
            statusTag: profileName,
            summary: lang === 'ru' ? (isCompensatoryOverdrive ? "–°–∏—Å—Ç–µ–º–∞ –≤ —Ä–µ–∂–∏–º–µ —Å–≤–µ—Ä—Ö–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏. –†–∏—Å–∫ —Å–∫—Ä—ã—Ç–æ–≥–æ –∏—Å—Ç–æ—â–µ–Ω–∏—è." : "–ê–Ω–∞–ª–∏–∑ –≤—ã—è–≤–∏–ª —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏.") : "·É°·É¢·É†·É£·É•·É¢·É£·É†·É£·Éö·Éò ·Éê·Éú·Éê·Éö·Éò·Éñ·Éò.",
            focusQuestion: lang === 'ru' ? (isCompensatoryOverdrive ? "–ö–∞–∫—É—é —É—è–∑–≤–∏–º–æ—Å—Ç—å –∑–∞—â–∏—â–∞–µ—Ç –≤–∞—à–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å?" : "–û—Ç —á–µ–≥–æ –≤—ã –±–µ–∂–∏—Ç–µ?") : "·É†·Éê·É° ·Éí·Éê·É£·É†·Éë·Éò·ÉÆ·Éê·É†·Éó?",
            tone: state.foundation < 40 ? 'alert' : 'supportive',
            recommendation: lang === 'ru' ? "–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ç–µ–Ω–∏." : "·Éû·É†·Éò·Éù·É†·Éò·É¢·Éî·É¢·Éò: ·É°·É¢·Éê·Éë·Éò·Éö·Éò·Éñ·Éê·É™·Éò·Éê.",
        },
        level2: {
            introduction: "üß¨ GENESIS OS // SUPERVISOR DOSSIER v3.3",
            generalConfig: `System Profile: ${profileName}. FARE Signature: [F:${state.foundation} A:${state.agency} R:${state.resource} E:${state.entropy}]`,
            psychodynamicProfile,
            deepAnalysis: lang === 'ru' ? `–ú–µ—Ö–∞–Ω–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã: ${psychodynamicProfile}` : "·É°·Éò·É°·É¢·Éî·Éõ·Éò·É° ·Éõ·Éî·É•·Éê·Éú·Éò·Éô·Éê.",
            archetypeAnalysis: `Dominant: ${archetypeKey}. Strategy: ${t.archetypes[archetypeKey]?.superpower}. Limit: ${t.archetypes[archetypeKey]?.shadow}.`,
            clinicalHypotheses: lang === 'ru' ? "1. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ —Å–µ–±–µ. 2. –ò–∑–±–µ–≥–∞–Ω–∏–µ –±–ª–∏–∑–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å." : "·Éô·Éö·Éò·Éú·Éò·Éô·É£·É†·Éò ·É∞·Éò·Éû·Éù·Éó·Éî·Éñ·Éî·Éë·Éò.",
            activePatterns: activePatterns.join(', '),
            verdictAndRecommendations: `Verdict: ${isCompensatoryOverdrive ? 'ARMORED_DEFENSE' : verdictKey}. Focus: ${isCompensatoryOverdrive ? 'Dismantling False Self' : 'Attachment security'}.`,
            resistanceProfile: lang === 'ru' ? "–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Ä–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è. –ö–ª–∏–µ–Ω—Ç –æ–±—ä—è—Å–Ω—è–µ—Ç, –∞ –Ω–µ —á—É–≤—Å—Ç–≤—É–µ—Ç." : "·Éò·Éú·É¢·Éî·Éö·Éî·É•·É¢·É£·Éê·Éö·Éò·Éñ·Éê·É™·Éò·Éê.",
            behavioralMarkers: lang === 'ru' ? "–ë—ã—Å—Ç—Ä–∞—è —Ä–µ—á—å, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞—É–∑, –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤ –æ —Ç–µ–ª–µ, –∏–¥–µ–∞–ª—å–Ω—ã–π —Ñ–∞—Å–∞–¥." : "·É°·É¨·É†·Éê·É§·Éò ·É°·Éê·É£·Éë·Éê·É†·Éò.",
            systemicRoot: lang === 'ru' ? "–ó–∞–º–µ—â–µ–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π —Ñ–∏–≥—É—Ä—ã —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é." : "·É°·Éò·É°·É¢·Éî·Éõ·É£·É†·Éò ·É§·Éî·É°·Éï·Éò.",
            therapeuticAlliance: lang === 'ru' ? "–†–∏—Å–∫ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ –∏–ª–∏ —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞." : "·Éê·É†·Éê·Éì·Éò·É†·Éî·É•·É¢·Éò·É£·Éö·Éò ·Éê·Éö·Éò·Éê·Éú·É°·Éò.",
            shadowContract: lang === 'ru' ? "–ü–æ–º–æ–≥–∏—Ç–µ –º–Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –≤–µ—á–Ω–æ –∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –±–æ–ª—å." : "·É©·É†·Éì·Éò·Éö·Éù·Éï·Éê·Éú·Éò ·Éô·Éù·Éú·É¢·É†·Éê·É•·É¢·Éò.",
            counterTransference,
            primaryDefense,
            therapeuticTrap,
            fragilityPoint,
            clinicalStrategy,
            triggers,
            blindSpots,
            sessionFlow: [
                { phase: 'ENTRY', title: lang === 'ru' ? '–ö–æ–Ω—Ñ—Ä–æ–Ω—Ç–∞—Ü–∏—è' : '·Éô·Éù·Éú·É§·É†·Éù·Éú·É¢·Éê·É™·Éò·Éê', action: lang === 'ru' ? '–í–æ–∑–≤—Ä–∞—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ —á—É–≤—Å—Ç–≤–∞.' : '·Éí·É†·É´·Éú·Éù·Éë·Éî·Éë·Éò.' },
                { phase: 'EXPLORATION', title: lang === 'ru' ? '–ü–æ–∏—Å–∫ —Ç—Ä–µ—â–∏–Ω—ã' : '·Éë·Éñ·Éê·É†·Éò', action: lang === 'ru' ? '–ì–¥–µ –≤—ã –Ω–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç–µ—Å—å?' : '·É°·Éê·Éì ·Éï·Éî·É† ·É£·Éõ·Éô·Éö·Éê·Éï·Éì·Éî·Éë·Éò·Éó?' },
                { phase: 'RESOLUTION', title: lang === 'ru' ? '–õ–µ–≥–∞–ª–∏–∑–∞—Ü–∏—è –±–µ—Å—Å–∏–ª–∏—è' : '·É£·É°·É£·É°·É£·É†·Éù·Éë·Éê', action: lang === 'ru' ? '–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –±—ã—Ç—å —Å–ª–∞–±—ã–º.' : '·É°·Éò·É°·É£·É°·É¢·Éò·É° ·É£·É§·Éö·Éî·Éë·Éê.' }
            ],
            clinicalProfile: `F:${state.foundation} A:${state.agency} R:${state.resource} E:${state.entropy}`,
            systemicVectors,
            interventions,
            differentialHypotheses
        },
    };
}


import { AnalysisResult, Translations, DomainType, BeliefKey } from "../types";
import { WEIGHTS } from "../services/psychologyService";

/**
 * Genesis OS Clinical Supervisor v2.1
 * –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –Ω–∞—Ä—Ä–∞—Ç–∏–≤–Ω—ã–π –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç.
 * Compliance: Art. 3 (Clinical Validity), Art. 21 (Simplicity)
 */
export const DossierService = {
  generateDossier(result: AnalysisResult, t: Translations): string {
    const { history, shareCode, state, neuroSync, archetypeKey } = result;
    const { foundation: f, agency: a, resource: r, entropy: e } = state;

    let d = "";
    const NL = "\n";
    const L = "================================================================================\n";
    const S = "--------------------------------------------------------------------------------\n";

    // --- 1. –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ü–†–û–§–ò–õ–Ø (–ü–°–ò–•–û–î–ò–ù–ê–ú–ò–ö–ê) ---
    // –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ª–∏—á–Ω–æ—Å—Ç–∏
    let profileType = "–ù–ï–í–†–û–¢–ò–ß–ï–°–ö–ò–ô (–ë–ê–ó–û–í–´–ô)";
    let profileDesc = "–ö–ª–∏–µ–Ω—Ç –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω, –Ω–æ —Ç—Ä–∞—Ç–∏—Ç —ç–Ω–µ—Ä–≥–∏—é –Ω–∞ –ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.";
    let strategy = "–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –≤—Ç–æ—Ä–∏—á–Ω—ã—Ö –≤—ã–≥–æ–¥.";

    if (f < 30) {
        profileType = "–î–ï–§–ò–¶–ò–¢–ê–†–ù–´–ô (–ü–û–ì–†–ê–ù–ò–ß–ù–´–ô –°–ü–ï–ö–¢–†)";
        profileDesc = "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –Ω–µ—Ö–≤–∞—Ç–∫–∞ –±–∞–∑–æ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. '–Ø' —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ. –í—ã—Å–æ–∫–∞—è —Ç—Ä–µ–≤–æ–≥–∞.";
        strategy = "–ü–û–î–î–ï–†–ñ–ö–ê –ò –ö–û–ù–¢–ï–ô–ù–ò–†–û–í–ê–ù–ò–ï. –ù–∏–∫–∞–∫–æ–π –∫–æ–Ω—Ñ—Ä–æ–Ω—Ç–∞—Ü–∏–∏.";
    } else if (a > 80 && f < 45) {
        profileType = "–ö–û–ú–ü–ï–ù–°–ê–¢–û–†–ù–´–ô (–ù–ê–†–¶–ò–°–°–ò–ß–ï–°–ö–ò–ô –°–ü–ï–ö–¢–†)";
        profileDesc = "–ì—Ä–∞–Ω–¥–∏–æ–∑–Ω–æ–µ '–Ø' (–í–æ–ª—è) –ø—Ä–∏–∫—Ä—ã–≤–∞–µ—Ç —Ö—Ä—É–ø–∫—É—é —Å–∞–º–æ–æ—Ü–µ–Ω–∫—É (–§—É–Ω–¥–∞–º–µ–Ω—Ç). –ë–µ–≥—Å—Ç–≤–æ –≤ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –æ—Ç —Å—Ç—ã–¥–∞.";
        strategy = "–ê–∫–∫—É—Ä–∞—Ç–Ω–∞—è –∫–æ–Ω—Ñ—Ä–æ–Ω—Ç–∞—Ü–∏—è —Å —É—è–∑–≤–∏–º–æ—Å—Ç—å—é. –í–æ–∑–≤—Ä–∞—Ç –≤ —Ç–µ–ª–æ.";
    } else if (e > 70) {
        profileType = "–•–ê–û–¢–ò–ß–ï–°–ö–ò–ô (–î–ò–§–§–£–ó–ù–´–ô)";
        profileDesc = "–°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–≥—Ä–µ—Ç–∞. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–µ–∫—Ç–æ—Ä–∞. –ö–ª–∏–µ–Ω—Ç –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç, —á–µ–≥–æ —Ö–æ—á–µ—Ç.";
        strategy = "–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ. –ü–æ–∏—Å–∫ –æ–¥–Ω–æ–π –º–∏–∫—Ä–æ-—Ü–µ–ª–∏.";
    } else if (neuroSync < 40) {
        profileType = "–î–ò–°–°–û–¶–ò–ê–¢–ò–í–ù–´–ô (–ò–ù–¢–ï–õ–õ–ï–ö–¢–£–ê–õ–ò–ó–ê–¶–ò–Ø)";
        profileDesc = "–ì–æ–ª–æ–≤–∞ –æ—Ç—Ä–µ–∑–∞–Ω–∞ –æ—Ç —Ç–µ–ª–∞. –ö–ª–∏–µ–Ω—Ç –≤—Å–µ '–ø–æ–Ω–∏–º–∞–µ—Ç', –Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ —á—É–≤—Å—Ç–≤—É–µ—Ç.";
        strategy = "–†–∞–±–æ—Ç–∞ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —Ç–µ–ª–æ –∏ –æ—â—É—â–µ–Ω–∏—è. –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.";
    }

    // --- 2. –¢–ò–¢–£–õ–¨–ù–´–ô –õ–ò–°–¢ ---
    d += L;
    d += `üß¨ GENESIS OS // –ö–õ–ò–ù–ò–ß–ï–°–ö–û–ï –î–û–°–¨–ï –°–£–ë–™–ï–ö–¢–ê // ID: ${shareCode.substring(0, 8)}\n`;
    d += `–ü–†–û–§–ò–õ–¨: ${profileType}\n`;
    d += L + NL;

    // --- 3. –°–¢–†–£–ö–¢–£–†–ù–´–ô –ê–ù–ê–õ–ò–ó (–ß–¢–û –ü–†–û–ò–°–•–û–î–ò–¢?) ---
    d += `[I. –°–¢–†–£–ö–¢–£–†–ù–´–ô –ê–ù–ê–õ–ò–ó]\n`;
    d += `–ö–ª–∏–Ω–∏—á–µ—Å–∫–∞—è –≥–∏–ø–æ—Ç–µ–∑–∞: ${profileDesc}\n`;
    d += NL;
    d += `–°–û–°–¢–û–Ø–ù–ò–ï –°–ò–°–¢–ï–ú–´:\n`;
    
    // Foundation
    d += `‚Ä¢ –§–£–ù–î–ê–ú–ï–ù–¢ (${f}%): `;
    if (f < 35) d += `–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –î–ï–§–ò–¶–ò–¢. –ö–ª–∏–µ–Ω—Ç –Ω–µ —á—É–≤—Å—Ç–≤—É–µ—Ç –ø—Ä–∞–≤–∞ –±—ã—Ç—å. –°—Ç—Ä–∞—Ö –ø–æ–≥–ª–æ—â–µ–Ω–∏—è –∏–ª–∏ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è.\n`;
    else if (f < 55) d += `–ù–ï–£–°–¢–û–ô–ß–ò–í–´–ô. –û–ø–æ—Ä–∞ –Ω–∞ –≤–Ω–µ—à–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏, –∞ –Ω–µ –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —è–¥—Ä–æ.\n`;
    else d += `–î–û–°–¢–ê–¢–û–ß–ù–´–ô. –ï—Å—Ç—å —Ä–µ—Å—É—Ä—Å –≤—ã–¥–µ—Ä–∂–∏–≤–∞—Ç—å –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π.\n`;

    // Agency
    d += `‚Ä¢ –í–û–õ–Ø (${a}%): `;
    if (a > 80) d += `–ì–ò–ü–ï–†-–ö–û–ú–ü–ï–ù–°–ê–¶–ò–Ø. –î–µ–π—Å—Ç–≤–∏–µ –∫–∞–∫ —Å–ø–æ—Å–æ–± –Ω–µ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –±–æ–ª—å. –†–∏—Å–∫ –≤—ã–≥–æ—Ä–∞–Ω–∏—è.\n`;
    else if (a < 35) d += `–í–´–£–ß–ï–ù–ù–ê–Ø –ë–ï–°–ü–û–ú–û–©–ù–û–°–¢–¨. –ü–∞—Ä–∞–ª–∏—á –≤–æ–ª–∏. –û–∂–∏–¥–∞–Ω–∏–µ —Å–ø–∞—Å–∞—Ç–µ–ª—è.\n`;
    else d += `–ê–î–ê–ü–¢–ò–í–ù–ê–Ø. –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫ –¥–µ–π—Å—Ç–≤–∏—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞.\n`;

    // Resource (Added to fix unused variable 'r')
    d += `‚Ä¢ –†–ï–°–£–†–° (${r}%): `;
    if (r < 40) d += `–ò–°–¢–û–©–ï–ù–ò–ï. –≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∞—è —è–º–∞. –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –¥–æ–ª–≥.\n`;
    else if (r > 70) d += `–ù–ê–ö–û–ü–õ–ï–ù–ò–ï. –í—ã—Å–æ–∫–∞—è –µ–º–∫–æ—Å—Ç—å, –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π –≤ –∏–∑–º–µ–Ω–µ–Ω–∏—è.\n`;
    else d += `–ë–ê–õ–ê–ù–°. –†–∞—Å—Ö–æ–¥ —ç–Ω–µ—Ä–≥–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é.\n`;

    // NeuroSync
    d += `‚Ä¢ –°–í–Ø–ó–¨ –£–ú-–¢–ï–õ–û (${neuroSync}%): `;
    if (neuroSync < 45) d += `‚ÄºÔ∏è –†–ê–ó–†–´–í. –ö–ª–∏–µ–Ω—Ç –ª–∂–µ—Ç —Å–∞–º —Å–µ–±–µ (–¥—É–º–∞–µ—Ç –æ–¥–Ω–æ, —Ç–µ–ª–æ —á—É–≤—Å—Ç–≤—É–µ—Ç –¥—Ä—É–≥–æ–µ).\n`;
    else d += `–ö–û–ì–ï–†–ï–ù–¢–ù–û. –î–æ—Å—Ç—É–ø –∫ –∞—Ñ—Ñ–µ–∫—Ç—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω.\n`;
    
    d += NL + S;

    // --- 4. –°–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –ö–ê–†–¢–ê –°–ú–´–°–õ–û–í ---
    // –ê–Ω–∞–ª–∏–∑ —Å–≤—è–∑–∫–∏ –î–æ–º–µ–Ω + –ó–æ–Ω–∞ —Ç–µ–ª–∞
    d += `[II. –°–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –ö–ê–†–¢–ê –°–ú–´–°–õ–û–í]\n`;
    const somaticClusters: Record<string, string[]> = {};
    
    history.forEach(h => {
        if (h.sensation === 's0') return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ
        const key = `${h.domain}_${h.sensation}`;
        if (!somaticClusters[key]) somaticClusters[key] = [];
        somaticClusters[key].push(h.beliefKey);
    });

    const activeClusters = Object.entries(somaticClusters)
        .filter(([_, beliefs]) => beliefs.length >= 1)
        .sort((a, b) => b[1].length - a[1].length)
        .slice(0, 3); // –¢–æ–ø-3 —Å–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–∞

    if (activeClusters.length === 0) {
        d += `–Ø–≤–Ω—ã—Ö —Å–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–≤—è–∑–æ–∫ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ. –õ–∏–±–æ –≤—ã—Å–æ–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è, –ª–∏–±–æ —Ç–æ—Ç–∞–ª—å–Ω–∞—è –∞–ª–µ–∫—Å–∏—Ç–∏–º–∏—è (—Å–º. NeuroSync).\n`;
    } else {
        activeClusters.forEach(([key, beliefs]) => {
            const [domain, sensation] = key.split('_');
            const domainName = t.domains[domain as DomainType].toUpperCase();
            
            let meaning = "";
            if (sensation === 's1') meaning = "–ó–ê–ü–†–ï–¢ –ù–ê –í–´–†–ê–ñ–ï–ù–ò–ï (–ö–û–ú –í –ì–û–†–õ–ï). –ö–ª–∏–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç '–æ–∑–≤—É—á–∏—Ç—å' —Å–≤–æ–∏ –ø—Ä–∞–≤–∞ –≤ —ç—Ç–æ–π —Å—Ñ–µ—Ä–µ.";
            if (sensation === 's2') meaning = "–°–ï–†–î–ï–ß–ù–ê–Ø –¢–û–°–ö–ê/–û–ë–ò–î–ê. –¢–µ–º–∞ –Ω–∞–≥—Ä—É–∂–µ–Ω–∞ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å—é.";
            if (sensation === 's3') meaning = "–ö–û–ù–§–õ–ò–ö–¢ –í–û–õ–ò (–°–ü–õ–ï–¢–ï–ù–ò–ï). '–•–æ—á—É, –Ω–æ –±–æ—é—Å—å' –∏–ª–∏ '–ù–∞–¥–æ, –Ω–æ –Ω–µ —Ö–æ—á—É'.";
            if (sensation === 's4') meaning = "–í–ò–¢–ê–õ–¨–ù–´–ô –°–¢–†–ê–• (–ñ–ò–í–û–¢). –£–≥—Ä–æ–∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –¢–µ–º–∞ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –∫–∞–∫ –≤–æ–ø—Ä–æ—Å –∂–∏–∑–Ω–∏ –∏ —Å–º–µ—Ä—Ç–∏.";

            d += `‚Ä¢ –°–§–ï–†–ê: ${domainName} -> –†–ï–ê–ö–¶–ò–Ø: ${sensation === 's1' ? '–ì–û–†–õ–û' : sensation === 's2' ? '–ì–†–£–î–¨' : sensation === 's3' ? '–°–ü–õ–ï–¢–ï–ù–ò–ï' : '–ñ–ò–í–û–¢'}\n`;
            d += `  –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è: ${meaning}\n`;
            d += `  –¢—Ä–∏–≥–≥–µ—Ä—ã: ${beliefs.map(b => t.beliefs[b as BeliefKey] || b).slice(0, 3).join(", ")}\n\n`;
        });
    }
    d += S;

    // --- 5. –Ø–î–†–ê –°–û–ü–†–û–¢–ò–í–õ–ï–ù–ò–Ø (–ì–î–ï –ë–û–õ–ò–¢?) ---
    d += `[III. –¢–û–ß–ö–ò –í–•–û–î–ê –í –¢–ï–†–ê–ü–ò–Æ]\n`;
    d += `–¢–µ–º—ã —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ–º (–õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å > 2.5—Å):\n\n`;

    const problemNodes = history
        .map(h => {
            const latScore = h.latency > 2500 ? (h.latency / 1000) : 0;
            const somaScore = (h.sensation === 's1' || h.sensation === 's4') ? 5 : 0; 
            const z = latScore + somaScore;
            return { ...h, score: z };
        })
        .filter(h => h.score > 2)
        .sort((a, b) => b.score - a.score)
        .slice(0, 3);

    if (problemNodes.length === 0) {
        d += `–ü–∏–∫–æ–≤ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ. –í–æ–∑–º–æ–∂–Ω–æ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø—É "–ò–¥–µ–∞–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç".\n`;
    } else {
        problemNodes.forEach((node, i) => {
            const belief = t.beliefs[node.beliefKey as BeliefKey] || node.beliefKey;
            d += `${i + 1}. –¢–ï–ú–ê: "${belief.toUpperCase()}" (${t.domains[node.domain]})\n`;
            
            const w = WEIGHTS[node.beliefKey] || WEIGHTS.default;
            d += `   –ì–ò–ü–û–¢–ï–ó–ê: `;
            if (w.f < 0) d += `–≠—Ç–æ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω —Ä–∞–∑—Ä—É—à–∞–µ—Ç –±–∞–∑–æ–≤—É—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å. `;
            if (w.a < 0) d += `–ë–ª–æ–∫–∏—Ä—É–µ—Ç —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å. `;
            d += `\n   –í–û–ü–†–û–°: "–ß—Ç–æ —Å—Ç—Ä–∞—à–Ω–æ–≥–æ —Å–ª—É—á–∏—Ç—Å—è, –µ—Å–ª–∏ –≤—ã –æ—Ç–∫–∞–∂–µ—Ç–µ—Å—å –æ—Ç —É–±–µ–∂–¥–µ–Ω–∏—è '${belief}'?"\n\n`;
        });
    }
    d += S;

    // --- 6. –¢–ï–ù–ï–í–û–ô –ö–û–ù–¢–†–ê–ö–¢ ---
    d += `[IV. –¢–ï–ù–ï–í–û–ô –ö–û–ù–¢–†–ê–ö–¢]\n`;
    d += `–°–∫—Ä—ã—Ç–∞—è –≤—ã–≥–æ–¥–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è:\n`;
    
    let shadowContract = "";
    if (archetypeKey === 'THE_BURNED_HERO') shadowContract = "–ï—Å–ª–∏ —è –æ—Å—Ç–∞–Ω–æ–≤–ª—é—Å—å, —è –ø–æ—á—É–≤—Å—Ç–≤—É—é —Å–≤–æ—é –Ω–∏–∫—á–µ–º–Ω–æ—Å—Ç—å. –Ø –≤—ã–±–∏—Ä–∞—é –∏–∑–Ω–æ—Å, —á—Ç–æ–±—ã –Ω–µ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å—Ç—ã–¥.";
    else if (archetypeKey === 'THE_GOLDEN_PRISONER') shadowContract = "–Ø –ø–ª–∞—á—É —Å–≤–æ–±–æ–¥–æ–π –∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å. –Ø –≤—ã–±–∏—Ä–∞—é –∑–æ–ª–æ—Ç—É—é –∫–ª–µ—Ç–∫—É, —á—Ç–æ–±—ã –Ω–µ –≤—Å—Ç—Ä–µ—á–∞—Ç—å—Å—è —Å —Ö–∞–æ—Å–æ–º –∂–∏–∑–Ω–∏.";
    else if (archetypeKey === 'THE_DRIFTER') shadowContract = "–Ø –Ω–∏ –∫ —á–µ–º—É –Ω–µ –ø—Ä–∏–≤—è–∑—ã–≤–∞—é—Å—å, —á—Ç–æ–±—ã –Ω–∏—á–µ–≥–æ –Ω–µ —Ç–µ—Ä—è—Ç—å. –Ø –≤—ã–±–∏—Ä–∞—é –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω–æ—Å—Ç—å –∫–∞–∫ –∑–∞—â–∏—Ç—É –æ—Ç –±–æ–ª–∏ —É—Ç—Ä–∞—Ç—ã.";
    else if (archetypeKey === 'THE_ARCHITECT') shadowContract = "–Ø –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é –≤—Å—ë, —á—Ç–æ–±—ã –Ω–µ –≤—Å—Ç—Ä–µ—á–∞—Ç—å—Å—è —Å —É—è–∑–≤–∏–º–æ—Å—Ç—å—é. –ú–æ–π –ø–æ—Ä—è–¥–æ–∫ ‚Äî —ç—Ç–æ –º–æ—è –∑–∞—â–∏—Ç–∞ –æ—Ç —Å—Ç—Ä–∞—Ö–∞.";
    else shadowContract = "–ë–µ—Å—Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ–µ —É–¥–µ—Ä–∂–∞–Ω–∏–µ —Å–∏–º–ø—Ç–æ–º–∞ —Ä–∞–¥–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ —Å–µ–º–µ–π–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –∏–ª–∏ –∏–∑–±–µ–≥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.";

    d += `"${shadowContract}"\n`;
    d += NL + S;

    // --- 7. –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø ---
    d += `[V. –ü–†–û–¢–û–ö–û–õ –¢–ï–†–ê–ü–ò–ò]\n`;
    d += `–°–¢–†–ê–¢–ï–ì–ò–Ø: ${strategy}\n`;
    d += `–ú–ò–®–ï–ù–¨: `;
    if (f < 40) d += `–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø–æ—Ä. –†–∞–±–æ—Ç–∞ —Å —Ñ–∏–≥—É—Ä–æ–π –ú–∞—Ç–µ—Ä–∏/–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –ù–µ –∏–¥–∏—Ç–µ –≤ —Ü–µ–ª–∏/–¥–µ–Ω—å–≥–∏, –ø–æ–∫–∞ –Ω–µ—Ç —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞.\n`;
    else if (neuroSync < 45) d += `–†–∞–∑–º–æ—Ä–æ–∑–∫–∞ –∞—Ñ—Ñ–µ–∫—Ç–∞. –õ–µ–≥–∞–ª–∏–∑—É–π—Ç–µ –∞–≥—Ä–µ—Å—Å–∏—é –∏ —Å—Ç—Ä–∞—Ö. –†–∞–±–æ—Ç–∞–π—Ç–µ —Å "–ö–æ–º–æ–º –≤ –≥–æ—Ä–ª–µ".\n`;
    else d += `–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¢–µ–Ω–∏. –†–∞–±–æ—Ç–∞ —Å –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–º–∏ –∂–µ–ª–∞–Ω–∏—è–º–∏ –∏ –∞–≥—Ä–µ—Å—Å–∏–µ–π.\n`;

    d += NL + L;
    d += `Genesis OS v18.0 // –î–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.`;
    
    return d;
  }
};
